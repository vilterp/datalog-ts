father{child: "Pete", father: "Paul"}.
father{child: "Paul", father: "Peter"}.
father{child: "Ann", father: "Peter"}.
father{child: "Mary", father: "Mark"}.
father{child: "Bob", father: "John"}.
mother{child: "Pete", mother: "Mary"}.
mother{child: "Paul", mother: "Judith"}.
mother{child: "Ann", mother: "Judith"}.
mother{child: "Bob", mother: "Ann"}.
mother{child: "Mary", mother: "Carolyn_K"}.
grandfather{grandchild: A, grandfather: C} :-
  parent{child: A, parent: B} &
  father{child: B, father: C}.
grandmother{grandchild: A, grandmother: C} :-
  child{child: A, parent: B} &
  mother{child: B, mother: C}.
grandparent{grandchild: A, grandparent: C} :-
  parent{child: A, parent: B} &
  parent{child: B, parent: C}.
parent{child: C, parent: P} :-
  mother{child: C, mother: P} | father{child: C, father: P}.
parents{child: C, mother: M, father: F} :-
  mother{child: C, mother: M} &
  father{child: C, father: F}.
sibling{left: L, right: R} :-
  parents{child: L, mother: M, father: F} &
  parents{child: R, mother: M, father: F}.
cousin{left: L, right: R} :-
  parent{child: L, parent: P1} &
  sibling{left: P1, right: P2} &
  parent{child: R, parent: P2}.
edge_m{from: C, to: M, label: "mother"} :-
    mother{child: C, mother: M}.
edge_f{from: C, to: F, label: "mother"} :-
    father{child: C, father: F}.
edge_gp{from: A, to: B, label: "grandparent"} :-
    grandparent{grandchild: A, grandparent: B}.
edge{from: F, to: T, label: L} :-
    edge_m{from: F, to: T, label: L} |
    edge_f{from: F, to: T, label: L} |
    edge_gp{from: F, to: T, label: L}.
node_mc{id: C, label: C} :-
    mother{child: C}.
node_mm{id: C, label: C} :-
    mother{mother: C}.
node_fc{id: C, label: C} :-
    father{child: C}.
node_ff{id: C, label: C} :-
    father{father: C}.
node{id: I, name: N} :-
    node_mc{id: I, name: N} |
    node_mm{id: I, name: N} |
    node_fc{id: I, name: N} |
    node_ff{id: I, name: N}.
----

father{child: X, father: Y}.
----
father{child: "Pete", father: "Paul"}.
father{child: "Paul", father: "Peter"}.
father{child: "Ann", father: "Peter"}.
father{child: "Mary", father: "Mark"}.
father{child: "Bob", father: "John"}.

father{child: "Pete", father: F}.
----
father{child: "Pete", father: "Paul"}.

parent{child: X, parent: Y}.
----
parent{child: "Pete", parent: "Mary"}.
parent{child: "Paul", parent: "Judith"}.
parent{child: "Ann", parent: "Judith"}.
parent{child: "Bob", parent: "Ann"}.
parent{child: "Mary", parent: "Carolyn_K"}.
parent{child: "Pete", parent: "Paul"}.
parent{child: "Paul", parent: "Peter"}.
parent{child: "Ann", parent: "Peter"}.
parent{child: "Mary", parent: "Mark"}.
parent{child: "Bob", parent: "John"}.

parent{child: "Pete", parent: Y}.
----
parent{child: "Pete", parent: "Mary"}.
parent{child: "Pete", parent: "Paul"}.

grandfather{grandchild: "Pete", grandfather: A}.
----
grandfather{grandchild: "Pete", grandfather: "Peter"}.
grandfather{grandchild: "Pete", grandfather: "Mark"}.

grandparent{grandchild: "Pete", grandparent: X}.
----
grandparent{grandchild: "Pete", grandparent: "Judith"}.
grandparent{grandchild: "Pete", grandparent: "Carolyn_K"}.
grandparent{grandchild: "Pete", grandparent: "Peter"}.
grandparent{grandchild: "Pete", grandparent: "Mark"}.

grandparent{grandchild: X, grandparent: Y}.
----
grandparent{grandchild: "Pete", grandparent: "Judith"}.
grandparent{grandchild: "Bob", grandparent: "Judith"}.
grandparent{grandchild: "Pete", grandparent: "Carolyn_K"}.
grandparent{grandchild: "Pete", grandparent: "Peter"}.
grandparent{grandchild: "Bob", grandparent: "Peter"}.
grandparent{grandchild: "Pete", grandparent: "Mark"}.

sibling{left: X, right: Y}.
----
sibling{left: "Pete", right: "Pete"}.

cousin{left: X, right: Y}.
----


.explain sibling{left: X, right: Y}.
----
Filter(sibling{left: X, right: Y})
  Project(sibling{left: L, right: R}, {L: X, R: Y})
    And(sibling{left: L, right: R})
      Filter(parents{child: R, father: F, mother: M})
        Project(parents{child: C, father: F, mother: M}, {C: R, F: F, M: M})
          Or
            And(parents{child: C, father: F, mother: M})
              Filter(father{child: C, father: F})
                Scan(father)
              Filter(mother{child: C, mother: M})
                Scan(mother)
      Filter(parents{child: L, father: F, mother: M})
        Project(parents{child: C, father: F, mother: M}, {C: L, F: F, M: M})
          Or
            And(parents{child: C, father: F, mother: M})
              Filter(father{child: C, father: F})
                Scan(father)
              Filter(mother{child: C, mother: M})
                Scan(mother)

.explain cousin{left: X, right: Y}.
----
Filter(cousin{left: X, right: Y})
  Project(cousin{left: L, right: R}, {L: X, R: Y})
    And(cousin{left: L, right: R})
      Filter(parent{child: R, parent: P2})
        Project(parent{child: C, parent: P}, {C: R, P: P2})
      And(cousin{left: L, right: R})
        Filter(sibling{left: P1, right: P2})
          Project(sibling{left: L, right: R}, {L: P1, R: P2})
        Filter(parent{child: L, parent: P1})
          Project(parent{child: C, parent: P}, {C: L, P: P1})
