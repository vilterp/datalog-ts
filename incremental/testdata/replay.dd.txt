.table mother
----
text/plain

.table father
----
text/plain

mother{child: "Pete", mother: "Mary"}.
----
text/plain
mother: [mother{child: "Pete", mother: "Mary"}; {}]

father{child: "Pete", father: "Paul"}.
----
text/plain
father: [father{child: "Pete", father: "Paul"}; {}]

mother{child: "Carolyn", mother: "Mary"}.
----
text/plain
mother: [mother{child: "Carolyn", mother: "Mary"}; {}]

father{child: "Carolyn", father: "Paul"}.
----
text/plain
father: [father{child: "Carolyn", father: "Paul"}; {}]

.rulegraph
----
text/plain
digraph G {
  "father" [label="father: Base" shape="box"]; // cache: [father{child: "Pete", father: "Paul"}; {}, father{child: "Carolyn", father: "Paul"}; {}]
  "mother" [label="mother: Base" shape="box"]; // cache: [mother{child: "Pete", mother: "Mary"}; {}, mother{child: "Carolyn", mother: "Mary"}; {}]
}

parents{child: C, mother: M, father: F} :-
  mother{child: C, mother: M} &
  father{child: C, father: F}.
----
text/plain
1: [mother{child: "Pete", mother: "Mary"}; {C: "Pete", M: "Mary"}]
2: []
1: [mother{child: "Carolyn", mother: "Mary"}; {C: "Carolyn", M: "Mary"}]
2: []
0: [father{child: "Pete", father: "Paul"}; {C: "Pete", F: "Paul"}]
2: [father{child: "Pete", father: "Paul"}; {C: "Pete", F: "Paul", M: "Mary"}]
parents: [parents{child: "Pete", father: "Paul", mother: "Mary"}; {C: "Pete", F: "Paul", M: "Mary"}]
0: [father{child: "Carolyn", father: "Paul"}; {C: "Carolyn", F: "Paul"}]
2: [father{child: "Carolyn", father: "Paul"}; {C: "Carolyn", F: "Paul", M: "Mary"}]
parents: [parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {C: "Carolyn", F: "Paul", M: "Mary"}]

.rulegraph
----
text/plain
digraph G {
  "0" [label="0: Match(father{child: C, father: F}; {})" shape="box"]; // cache: [father{child: "Pete", father: "Paul"}; {C: "Pete", F: "Paul"}, father{child: "Carolyn", father: "Paul"}; {C: "Carolyn", F: "Paul"}]
  "1" [label="1: Match(mother{child: C, mother: M}; {})" shape="box"]; // cache: [mother{child: "Pete", mother: "Mary"}; {C: "Pete", M: "Mary"}, mother{child: "Carolyn", mother: "Mary"}; {C: "Carolyn", M: "Mary"}]
  "2" [label="2: Join(1 & 0)" shape="box"]; // cache: [father{child: "Pete", father: "Paul"}; {C: "Pete", F: "Paul", M: "Mary"}, father{child: "Carolyn", father: "Paul"}; {C: "Carolyn", F: "Paul", M: "Mary"}]
  "father" [label="father: Base" shape="box"]; // cache: [father{child: "Pete", father: "Paul"}; {}, father{child: "Carolyn", father: "Paul"}; {}]
  "mother" [label="mother: Base" shape="box"]; // cache: [mother{child: "Pete", mother: "Mary"}; {}, mother{child: "Carolyn", mother: "Mary"}; {}]
  "parents" [label="parents: Subst(parents{child: C, father: F, mother: M})" shape="box"]; // cache: [parents{child: "Pete", father: "Paul", mother: "Mary"}; {C: "Pete", F: "Paul", M: "Mary"}, parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {C: "Carolyn", F: "Paul", M: "Mary"}]
  "0" -> "2" [];
  "1" -> "2" [];
  "2" -> "parents" [];
  "father" -> "0" [];
  "mother" -> "1" [];
}

sibling{left: L, right: R} :-
  parents{child: L, mother: M, father: F} &
  parents{child: R, mother: M, father: F} &
  L != R.
----
text/plain
3: [parents{child: "Pete", father: "Paul", mother: "Mary"}; {F: "Paul", M: "Mary", R: "Pete"}]
5: []
4: [parents{child: "Pete", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Pete", M: "Mary"}]
5: [parents{child: "Pete", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Pete", M: "Mary", R: "Pete"}]
6: []
3: [parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {F: "Paul", M: "Mary", R: "Carolyn"}]
5: [parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Pete", M: "Mary", R: "Carolyn"}]
6: [parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Pete", M: "Mary", R: "Carolyn"}]
sibling: [sibling{left: "Pete", right: "Carolyn"}; {F: "Paul", L: "Pete", M: "Mary", R: "Carolyn"}]
4: [parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Carolyn", M: "Mary"}]
5: [parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Carolyn", M: "Mary", R: "Pete"}, parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Carolyn", M: "Mary", R: "Carolyn"}]
6: [parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Carolyn", M: "Mary", R: "Pete"}]
6: []
sibling: [sibling{left: "Carolyn", right: "Pete"}; {F: "Paul", L: "Carolyn", M: "Mary", R: "Pete"}]

.rulegraph
----
text/plain
digraph G {
  "0" [label="0: Match(father{child: C, father: F}; {})" shape="box"]; // cache: [father{child: "Pete", father: "Paul"}; {C: "Pete", F: "Paul"}, father{child: "Carolyn", father: "Paul"}; {C: "Carolyn", F: "Paul"}]
  "1" [label="1: Match(mother{child: C, mother: M}; {})" shape="box"]; // cache: [mother{child: "Pete", mother: "Mary"}; {C: "Pete", M: "Mary"}, mother{child: "Carolyn", mother: "Mary"}; {C: "Carolyn", M: "Mary"}]
  "2" [label="2: Join(1 & 0)" shape="box"]; // cache: [father{child: "Pete", father: "Paul"}; {C: "Pete", F: "Paul", M: "Mary"}, father{child: "Carolyn", father: "Paul"}; {C: "Carolyn", F: "Paul", M: "Mary"}]
  "3" [label="3: Match(parents{child: R, father: F, mother: M}; {C: R, F: F, M: M})" shape="box"]; // cache: [parents{child: "Pete", father: "Paul", mother: "Mary"}; {F: "Paul", M: "Mary", R: "Pete"}, parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {F: "Paul", M: "Mary", R: "Carolyn"}]
  "4" [label="4: Match(parents{child: L, father: F, mother: M}; {C: L, F: F, M: M})" shape="box"]; // cache: [parents{child: "Pete", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Pete", M: "Mary"}, parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Carolyn", M: "Mary"}]
  "5" [label="5: Join(4 & 3)" shape="box"]; // cache: [parents{child: "Pete", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Pete", M: "Mary", R: "Pete"}, parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Pete", M: "Mary", R: "Carolyn"}, parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Carolyn", M: "Mary", R: "Pete"}, parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Carolyn", M: "Mary", R: "Carolyn"}]
  "6" [label="6: L != R" shape="box"]; // cache: [parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Pete", M: "Mary", R: "Carolyn"}, parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {F: "Paul", L: "Carolyn", M: "Mary", R: "Pete"}]
  "father" [label="father: Base" shape="box"]; // cache: [father{child: "Pete", father: "Paul"}; {}, father{child: "Carolyn", father: "Paul"}; {}]
  "mother" [label="mother: Base" shape="box"]; // cache: [mother{child: "Pete", mother: "Mary"}; {}, mother{child: "Carolyn", mother: "Mary"}; {}]
  "parents" [label="parents: Subst(parents{child: C, father: F, mother: M})" shape="box"]; // cache: [parents{child: "Pete", father: "Paul", mother: "Mary"}; {C: "Pete", F: "Paul", M: "Mary"}, parents{child: "Carolyn", father: "Paul", mother: "Mary"}; {C: "Carolyn", F: "Paul", M: "Mary"}]
  "sibling" [label="sibling: Subst(sibling{left: L, right: R})" shape="box"]; // cache: [sibling{left: "Pete", right: "Carolyn"}; {F: "Paul", L: "Pete", M: "Mary", R: "Carolyn"}, sibling{left: "Carolyn", right: "Pete"}; {F: "Paul", L: "Carolyn", M: "Mary", R: "Pete"}]
  "0" -> "2" [];
  "1" -> "2" [];
  "2" -> "parents" [];
  "3" -> "5" [];
  "4" -> "5" [];
  "5" -> "6" [];
  "6" -> "sibling" [];
  "father" -> "0" [];
  "mother" -> "1" [];
  "parents" -> "3" [];
  "parents" -> "4" [];
}
