main :- "foo".
--
foo
----
text/plain
source from null: source{char: "\n", pos: 0}; {}. 
  source{char: "\n", pos: 0}; {}
0 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "f", pos: P1}; {})
3 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "o", pos: P2}; {})
7 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "o", pos: P3}; {})
--
source from null: source{char: "f", pos: 1}; {}. 
  source{char: "f", pos: 1}; {}
0 from source: source{char: "f", pos: 1}; {}. Match(source{char: "f", pos: P1}; {})
  source{char: "f", pos: 1}; {P1: 1}
3 from source: source{char: "f", pos: 1}; {}. Match(source{char: "o", pos: P2}; {})
7 from source: source{char: "f", pos: 1}; {}. Match(source{char: "o", pos: P3}; {})
2 from 0: source{char: "f", pos: 1}; {P1: 1}. Join(P1)
--
source from null: source{char: "o", pos: 2}; {}. 
  source{char: "o", pos: 2}; {}
0 from source: source{char: "o", pos: 2}; {}. Match(source{char: "f", pos: P1}; {})
3 from source: source{char: "o", pos: 2}; {}. Match(source{char: "o", pos: P2}; {})
  source{char: "o", pos: 2}; {P2: 2}
7 from source: source{char: "o", pos: 2}; {}. Match(source{char: "o", pos: P3}; {})
  source{char: "o", pos: 2}; {P3: 2}
4 from 3: source{char: "o", pos: 2}; {P2: 2}. Join(P2)
8 from 7: source{char: "o", pos: 2}; {P3: 2}. Join(P3)
--
source from null: source{char: "o", pos: 3}; {}. 
  source{char: "o", pos: 3}; {}
0 from source: source{char: "o", pos: 3}; {}. Match(source{char: "f", pos: P1}; {})
3 from source: source{char: "o", pos: 3}; {}. Match(source{char: "o", pos: P2}; {})
  source{char: "o", pos: 3}; {P2: 3}
7 from source: source{char: "o", pos: 3}; {}. Match(source{char: "o", pos: P3}; {})
  source{char: "o", pos: 3}; {P3: 3}
4 from 3: source{char: "o", pos: 3}; {P2: 3}. Join(P2)
8 from 7: source{char: "o", pos: 3}; {P3: 3}. Join(P3)
--
next from null: next{left: 0, right: 1}; {}. 
  next{left: 0, right: 1}; {}
1 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
5 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
2 from 1: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
6 from 5: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
--
next from null: next{left: 1, right: 2}; {}. 
  next{left: 1, right: 2}; {}
1 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
5 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
2 from 1: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
  (); {P1: 1, P2: 2}
6 from 5: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
4 from 2: (); {P1: 1, P2: 2}. Join(P2)
  (); {P1: 1, P2: 2}
6 from 4: (); {P1: 1, P2: 2}. Join(P2)
--
next from null: next{left: 2, right: 3}; {}. 
  next{left: 2, right: 3}; {}
1 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
5 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
2 from 1: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
6 from 5: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
  (); {P1: 1, P2: 2, P3: 3}
8 from 6: (); {P1: 1, P2: 2, P3: 3}. Join(P3)
  (); {P1: 1, P2: 2, P3: 3}
main from 8: (); {P1: 1, P2: 2, P3: 3}. Subst({from: P1, to: P3})
  main{from: 1, to: 3}; {P1: 1, P2: 2, P3: 3}

main :- ["foo", "bar"].
--
foobar
----
text/plain
source from null: source{char: "\n", pos: 0}; {}. 
  source{char: "\n", pos: 0}; {}
5 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "f", pos: P1}; {})
8 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "o", pos: P2}; {})
12 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "o", pos: P3}; {})
14 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "b", pos: P1}; {})
17 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "a", pos: P2}; {})
21 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "r", pos: P3}; {})
--
source from null: source{char: "f", pos: 1}; {}. 
  source{char: "f", pos: 1}; {}
5 from source: source{char: "f", pos: 1}; {}. Match(source{char: "f", pos: P1}; {})
  source{char: "f", pos: 1}; {P1: 1}
8 from source: source{char: "f", pos: 1}; {}. Match(source{char: "o", pos: P2}; {})
12 from source: source{char: "f", pos: 1}; {}. Match(source{char: "o", pos: P3}; {})
14 from source: source{char: "f", pos: 1}; {}. Match(source{char: "b", pos: P1}; {})
17 from source: source{char: "f", pos: 1}; {}. Match(source{char: "a", pos: P2}; {})
21 from source: source{char: "f", pos: 1}; {}. Match(source{char: "r", pos: P3}; {})
7 from 5: source{char: "f", pos: 1}; {P1: 1}. Join(P1)
--
source from null: source{char: "o", pos: 2}; {}. 
  source{char: "o", pos: 2}; {}
5 from source: source{char: "o", pos: 2}; {}. Match(source{char: "f", pos: P1}; {})
8 from source: source{char: "o", pos: 2}; {}. Match(source{char: "o", pos: P2}; {})
  source{char: "o", pos: 2}; {P2: 2}
12 from source: source{char: "o", pos: 2}; {}. Match(source{char: "o", pos: P3}; {})
  source{char: "o", pos: 2}; {P3: 2}
14 from source: source{char: "o", pos: 2}; {}. Match(source{char: "b", pos: P1}; {})
17 from source: source{char: "o", pos: 2}; {}. Match(source{char: "a", pos: P2}; {})
21 from source: source{char: "o", pos: 2}; {}. Match(source{char: "r", pos: P3}; {})
9 from 8: source{char: "o", pos: 2}; {P2: 2}. Join(P2)
13 from 12: source{char: "o", pos: 2}; {P3: 2}. Join(P3)
--
source from null: source{char: "o", pos: 3}; {}. 
  source{char: "o", pos: 3}; {}
5 from source: source{char: "o", pos: 3}; {}. Match(source{char: "f", pos: P1}; {})
8 from source: source{char: "o", pos: 3}; {}. Match(source{char: "o", pos: P2}; {})
  source{char: "o", pos: 3}; {P2: 3}
12 from source: source{char: "o", pos: 3}; {}. Match(source{char: "o", pos: P3}; {})
  source{char: "o", pos: 3}; {P3: 3}
14 from source: source{char: "o", pos: 3}; {}. Match(source{char: "b", pos: P1}; {})
17 from source: source{char: "o", pos: 3}; {}. Match(source{char: "a", pos: P2}; {})
21 from source: source{char: "o", pos: 3}; {}. Match(source{char: "r", pos: P3}; {})
9 from 8: source{char: "o", pos: 3}; {P2: 3}. Join(P2)
13 from 12: source{char: "o", pos: 3}; {P3: 3}. Join(P3)
--
source from null: source{char: "b", pos: 4}; {}. 
  source{char: "b", pos: 4}; {}
5 from source: source{char: "b", pos: 4}; {}. Match(source{char: "f", pos: P1}; {})
8 from source: source{char: "b", pos: 4}; {}. Match(source{char: "o", pos: P2}; {})
12 from source: source{char: "b", pos: 4}; {}. Match(source{char: "o", pos: P3}; {})
14 from source: source{char: "b", pos: 4}; {}. Match(source{char: "b", pos: P1}; {})
  source{char: "b", pos: 4}; {P1: 4}
17 from source: source{char: "b", pos: 4}; {}. Match(source{char: "a", pos: P2}; {})
21 from source: source{char: "b", pos: 4}; {}. Match(source{char: "r", pos: P3}; {})
16 from 14: source{char: "b", pos: 4}; {P1: 4}. Join(P1)
--
source from null: source{char: "a", pos: 5}; {}. 
  source{char: "a", pos: 5}; {}
5 from source: source{char: "a", pos: 5}; {}. Match(source{char: "f", pos: P1}; {})
8 from source: source{char: "a", pos: 5}; {}. Match(source{char: "o", pos: P2}; {})
12 from source: source{char: "a", pos: 5}; {}. Match(source{char: "o", pos: P3}; {})
14 from source: source{char: "a", pos: 5}; {}. Match(source{char: "b", pos: P1}; {})
17 from source: source{char: "a", pos: 5}; {}. Match(source{char: "a", pos: P2}; {})
  source{char: "a", pos: 5}; {P2: 5}
21 from source: source{char: "a", pos: 5}; {}. Match(source{char: "r", pos: P3}; {})
18 from 17: source{char: "a", pos: 5}; {P2: 5}. Join(P2)
--
source from null: source{char: "r", pos: 6}; {}. 
  source{char: "r", pos: 6}; {}
5 from source: source{char: "r", pos: 6}; {}. Match(source{char: "f", pos: P1}; {})
8 from source: source{char: "r", pos: 6}; {}. Match(source{char: "o", pos: P2}; {})
12 from source: source{char: "r", pos: 6}; {}. Match(source{char: "o", pos: P3}; {})
14 from source: source{char: "r", pos: 6}; {}. Match(source{char: "b", pos: P1}; {})
17 from source: source{char: "r", pos: 6}; {}. Match(source{char: "a", pos: P2}; {})
21 from source: source{char: "r", pos: 6}; {}. Match(source{char: "r", pos: P3}; {})
  source{char: "r", pos: 6}; {P3: 6}
22 from 21: source{char: "r", pos: 6}; {P3: 6}. Join(P3)
--
next from null: next{left: 0, right: 1}; {}. 
  next{left: 0, right: 1}; {}
1 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
6 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
10 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
15 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
19 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
2 from 1: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P3)
7 from 6: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
11 from 10: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
16 from 15: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
20 from 19: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
--
next from null: next{left: 1, right: 2}; {}. 
  next{left: 1, right: 2}; {}
1 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
6 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
10 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
15 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
19 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
2 from 1: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P3)
7 from 6: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
  (); {P1: 1, P2: 2}
11 from 10: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
16 from 15: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
20 from 19: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
9 from 7: (); {P1: 1, P2: 2}. Join(P2)
  (); {P1: 1, P2: 2}
11 from 9: (); {P1: 1, P2: 2}. Join(P2)
--
next from null: next{left: 2, right: 3}; {}. 
  next{left: 2, right: 3}; {}
1 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
6 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
10 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
15 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
19 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
2 from 1: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P3)
7 from 6: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
11 from 10: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
  (); {P1: 1, P2: 2, P3: 3}
16 from 15: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
20 from 19: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
13 from 11: (); {P1: 1, P2: 2, P3: 3}. Join(P3)
  (); {P1: 1, P2: 2, P3: 3}
main_seq_0 from 13: (); {P1: 1, P2: 2, P3: 3}. Subst({from: P1, to: P3})
  main_seq_0{from: 1, to: 3}; {P1: 1, P2: 2, P3: 3}
3 from main_seq_0: main_seq_0{from: 1, to: 3}; {P1: 1, P2: 2, P3: 3}. Match(main_seq_0{from: P1, to: P2}; {P1: P1, P3: P2})
  main_seq_0{from: 1, to: 3}; {P1: 1, P2: 3}
4 from 3: main_seq_0{from: 1, to: 3}; {P1: 1, P2: 3}. Join(P2)
--
next from null: next{left: 3, right: 4}; {}. 
  next{left: 3, right: 4}; {}
1 from next: next{left: 3, right: 4}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 3, right: 4}; {P2: 3, P3: 4}
6 from next: next{left: 3, right: 4}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 3, right: 4}; {P1: 3, P2: 4}
10 from next: next{left: 3, right: 4}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 3, right: 4}; {P2: 3, P3: 4}
15 from next: next{left: 3, right: 4}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 3, right: 4}; {P1: 3, P2: 4}
19 from next: next{left: 3, right: 4}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 3, right: 4}; {P2: 3, P3: 4}
2 from 1: next{left: 3, right: 4}; {P2: 3, P3: 4}. Join(P3)
7 from 6: next{left: 3, right: 4}; {P1: 3, P2: 4}. Join(P1)
11 from 10: next{left: 3, right: 4}; {P2: 3, P3: 4}. Join(P2)
16 from 15: next{left: 3, right: 4}; {P1: 3, P2: 4}. Join(P1)
20 from 19: next{left: 3, right: 4}; {P2: 3, P3: 4}. Join(P2)
--
next from null: next{left: 4, right: 5}; {}. 
  next{left: 4, right: 5}; {}
1 from next: next{left: 4, right: 5}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 4, right: 5}; {P2: 4, P3: 5}
6 from next: next{left: 4, right: 5}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 4, right: 5}; {P1: 4, P2: 5}
10 from next: next{left: 4, right: 5}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 4, right: 5}; {P2: 4, P3: 5}
15 from next: next{left: 4, right: 5}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 4, right: 5}; {P1: 4, P2: 5}
19 from next: next{left: 4, right: 5}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 4, right: 5}; {P2: 4, P3: 5}
2 from 1: next{left: 4, right: 5}; {P2: 4, P3: 5}. Join(P3)
7 from 6: next{left: 4, right: 5}; {P1: 4, P2: 5}. Join(P1)
11 from 10: next{left: 4, right: 5}; {P2: 4, P3: 5}. Join(P2)
16 from 15: next{left: 4, right: 5}; {P1: 4, P2: 5}. Join(P1)
  (); {P1: 4, P2: 5}
20 from 19: next{left: 4, right: 5}; {P2: 4, P3: 5}. Join(P2)
18 from 16: (); {P1: 4, P2: 5}. Join(P2)
  (); {P1: 4, P2: 5}
20 from 18: (); {P1: 4, P2: 5}. Join(P2)
--
next from null: next{left: 5, right: 6}; {}. 
  next{left: 5, right: 6}; {}
1 from next: next{left: 5, right: 6}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 5, right: 6}; {P2: 5, P3: 6}
6 from next: next{left: 5, right: 6}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 5, right: 6}; {P1: 5, P2: 6}
10 from next: next{left: 5, right: 6}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 5, right: 6}; {P2: 5, P3: 6}
15 from next: next{left: 5, right: 6}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 5, right: 6}; {P1: 5, P2: 6}
19 from next: next{left: 5, right: 6}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 5, right: 6}; {P2: 5, P3: 6}
2 from 1: next{left: 5, right: 6}; {P2: 5, P3: 6}. Join(P3)
7 from 6: next{left: 5, right: 6}; {P1: 5, P2: 6}. Join(P1)
11 from 10: next{left: 5, right: 6}; {P2: 5, P3: 6}. Join(P2)
16 from 15: next{left: 5, right: 6}; {P1: 5, P2: 6}. Join(P1)
20 from 19: next{left: 5, right: 6}; {P2: 5, P3: 6}. Join(P2)
  (); {P1: 4, P2: 5, P3: 6}
22 from 20: (); {P1: 4, P2: 5, P3: 6}. Join(P3)
  (); {P1: 4, P2: 5, P3: 6}
main_seq_1 from 22: (); {P1: 4, P2: 5, P3: 6}. Subst({from: P1, to: P3})
  main_seq_1{from: 4, to: 6}; {P1: 4, P2: 5, P3: 6}
0 from main_seq_1: main_seq_1{from: 4, to: 6}; {P1: 4, P2: 5, P3: 6}. Match(main_seq_1{from: P3, to: P4}; {P1: P3, P3: P4})
  main_seq_1{from: 4, to: 6}; {P3: 4, P4: 6}
2 from 0: main_seq_1{from: 4, to: 6}; {P3: 4, P4: 6}. Join(P3)
  (); {P2: 3, P3: 4, P4: 6}
4 from 2: (); {P2: 3, P3: 4, P4: 6}. Join(P2)
  (); {P1: 1, P2: 3, P3: 4, P4: 6}
main from 4: (); {P1: 1, P2: 3, P3: 4, P4: 6}. Subst({from: P1, to: P4})
  main{from: 1, to: 6}; {P1: 1, P2: 3, P3: 4, P4: 6}

main :- ("foo" | "bar").
--
foo
----
text/plain
source from null: source{char: "\n", pos: 0}; {}. 
  source{char: "\n", pos: 0}; {}
3 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "f", pos: P1}; {})
6 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "o", pos: P2}; {})
10 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "o", pos: P3}; {})
12 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "b", pos: P1}; {})
15 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "a", pos: P2}; {})
19 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "r", pos: P3}; {})
--
source from null: source{char: "f", pos: 1}; {}. 
  source{char: "f", pos: 1}; {}
3 from source: source{char: "f", pos: 1}; {}. Match(source{char: "f", pos: P1}; {})
  source{char: "f", pos: 1}; {P1: 1}
6 from source: source{char: "f", pos: 1}; {}. Match(source{char: "o", pos: P2}; {})
10 from source: source{char: "f", pos: 1}; {}. Match(source{char: "o", pos: P3}; {})
12 from source: source{char: "f", pos: 1}; {}. Match(source{char: "b", pos: P1}; {})
15 from source: source{char: "f", pos: 1}; {}. Match(source{char: "a", pos: P2}; {})
19 from source: source{char: "f", pos: 1}; {}. Match(source{char: "r", pos: P3}; {})
5 from 3: source{char: "f", pos: 1}; {P1: 1}. Join(P1)
--
source from null: source{char: "o", pos: 2}; {}. 
  source{char: "o", pos: 2}; {}
3 from source: source{char: "o", pos: 2}; {}. Match(source{char: "f", pos: P1}; {})
6 from source: source{char: "o", pos: 2}; {}. Match(source{char: "o", pos: P2}; {})
  source{char: "o", pos: 2}; {P2: 2}
10 from source: source{char: "o", pos: 2}; {}. Match(source{char: "o", pos: P3}; {})
  source{char: "o", pos: 2}; {P3: 2}
12 from source: source{char: "o", pos: 2}; {}. Match(source{char: "b", pos: P1}; {})
15 from source: source{char: "o", pos: 2}; {}. Match(source{char: "a", pos: P2}; {})
19 from source: source{char: "o", pos: 2}; {}. Match(source{char: "r", pos: P3}; {})
7 from 6: source{char: "o", pos: 2}; {P2: 2}. Join(P2)
11 from 10: source{char: "o", pos: 2}; {P3: 2}. Join(P3)
--
source from null: source{char: "o", pos: 3}; {}. 
  source{char: "o", pos: 3}; {}
3 from source: source{char: "o", pos: 3}; {}. Match(source{char: "f", pos: P1}; {})
6 from source: source{char: "o", pos: 3}; {}. Match(source{char: "o", pos: P2}; {})
  source{char: "o", pos: 3}; {P2: 3}
10 from source: source{char: "o", pos: 3}; {}. Match(source{char: "o", pos: P3}; {})
  source{char: "o", pos: 3}; {P3: 3}
12 from source: source{char: "o", pos: 3}; {}. Match(source{char: "b", pos: P1}; {})
15 from source: source{char: "o", pos: 3}; {}. Match(source{char: "a", pos: P2}; {})
19 from source: source{char: "o", pos: 3}; {}. Match(source{char: "r", pos: P3}; {})
7 from 6: source{char: "o", pos: 3}; {P2: 3}. Join(P2)
11 from 10: source{char: "o", pos: 3}; {P3: 3}. Join(P3)
--
next from null: next{left: 0, right: 1}; {}. 
  next{left: 0, right: 1}; {}
4 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
8 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
13 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
17 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
5 from 4: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
9 from 8: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
14 from 13: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
18 from 17: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
--
next from null: next{left: 1, right: 2}; {}. 
  next{left: 1, right: 2}; {}
4 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
8 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
13 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
17 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
5 from 4: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
  (); {P1: 1, P2: 2}
9 from 8: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
14 from 13: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
18 from 17: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
7 from 5: (); {P1: 1, P2: 2}. Join(P2)
  (); {P1: 1, P2: 2}
9 from 7: (); {P1: 1, P2: 2}. Join(P2)
--
next from null: next{left: 2, right: 3}; {}. 
  next{left: 2, right: 3}; {}
4 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
8 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
13 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
17 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
5 from 4: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
9 from 8: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
  (); {P1: 1, P2: 2, P3: 3}
14 from 13: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
18 from 17: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
11 from 9: (); {P1: 1, P2: 2, P3: 3}. Join(P3)
  (); {P1: 1, P2: 2, P3: 3}
main_choice_0 from 11: (); {P1: 1, P2: 2, P3: 3}. Subst({from: P1, to: P3})
  main_choice_0{from: 1, to: 3}; {P1: 1, P2: 2, P3: 3}
1 from main_choice_0: main_choice_0{from: 1, to: 3}; {P1: 1, P2: 2, P3: 3}. Match(main_choice_0{from: P1, to: P2}; {P1: P1, P3: P2})
  main_choice_0{from: 1, to: 3}; {P1: 1, P2: 3}
0 from 1: main_choice_0{from: 1, to: 3}; {P1: 1, P2: 3}. Union
  main_choice_0{from: 1, to: 3}; {P1: 1, P2: 3}
main from 0: main_choice_0{from: 1, to: 3}; {P1: 1, P2: 3}. Subst({from: P1, to: P2})
  main{from: 1, to: 3}; {P1: 1, P2: 3}

main :- ("foo" | "bar").
--
bar
----
text/plain
source from null: source{char: "\n", pos: 0}; {}. 
  source{char: "\n", pos: 0}; {}
3 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "f", pos: P1}; {})
6 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "o", pos: P2}; {})
10 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "o", pos: P3}; {})
12 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "b", pos: P1}; {})
15 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "a", pos: P2}; {})
19 from source: source{char: "\n", pos: 0}; {}. Match(source{char: "r", pos: P3}; {})
--
source from null: source{char: "b", pos: 1}; {}. 
  source{char: "b", pos: 1}; {}
3 from source: source{char: "b", pos: 1}; {}. Match(source{char: "f", pos: P1}; {})
6 from source: source{char: "b", pos: 1}; {}. Match(source{char: "o", pos: P2}; {})
10 from source: source{char: "b", pos: 1}; {}. Match(source{char: "o", pos: P3}; {})
12 from source: source{char: "b", pos: 1}; {}. Match(source{char: "b", pos: P1}; {})
  source{char: "b", pos: 1}; {P1: 1}
15 from source: source{char: "b", pos: 1}; {}. Match(source{char: "a", pos: P2}; {})
19 from source: source{char: "b", pos: 1}; {}. Match(source{char: "r", pos: P3}; {})
14 from 12: source{char: "b", pos: 1}; {P1: 1}. Join(P1)
--
source from null: source{char: "a", pos: 2}; {}. 
  source{char: "a", pos: 2}; {}
3 from source: source{char: "a", pos: 2}; {}. Match(source{char: "f", pos: P1}; {})
6 from source: source{char: "a", pos: 2}; {}. Match(source{char: "o", pos: P2}; {})
10 from source: source{char: "a", pos: 2}; {}. Match(source{char: "o", pos: P3}; {})
12 from source: source{char: "a", pos: 2}; {}. Match(source{char: "b", pos: P1}; {})
15 from source: source{char: "a", pos: 2}; {}. Match(source{char: "a", pos: P2}; {})
  source{char: "a", pos: 2}; {P2: 2}
19 from source: source{char: "a", pos: 2}; {}. Match(source{char: "r", pos: P3}; {})
16 from 15: source{char: "a", pos: 2}; {P2: 2}. Join(P2)
--
source from null: source{char: "r", pos: 3}; {}. 
  source{char: "r", pos: 3}; {}
3 from source: source{char: "r", pos: 3}; {}. Match(source{char: "f", pos: P1}; {})
6 from source: source{char: "r", pos: 3}; {}. Match(source{char: "o", pos: P2}; {})
10 from source: source{char: "r", pos: 3}; {}. Match(source{char: "o", pos: P3}; {})
12 from source: source{char: "r", pos: 3}; {}. Match(source{char: "b", pos: P1}; {})
15 from source: source{char: "r", pos: 3}; {}. Match(source{char: "a", pos: P2}; {})
19 from source: source{char: "r", pos: 3}; {}. Match(source{char: "r", pos: P3}; {})
  source{char: "r", pos: 3}; {P3: 3}
20 from 19: source{char: "r", pos: 3}; {P3: 3}. Join(P3)
--
next from null: next{left: 0, right: 1}; {}. 
  next{left: 0, right: 1}; {}
4 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
8 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
13 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
17 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
5 from 4: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
9 from 8: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
14 from 13: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
18 from 17: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
--
next from null: next{left: 1, right: 2}; {}. 
  next{left: 1, right: 2}; {}
4 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
8 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
13 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
17 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
5 from 4: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
9 from 8: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
14 from 13: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
  (); {P1: 1, P2: 2}
18 from 17: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
16 from 14: (); {P1: 1, P2: 2}. Join(P2)
  (); {P1: 1, P2: 2}
18 from 16: (); {P1: 1, P2: 2}. Join(P2)
--
next from null: next{left: 2, right: 3}; {}. 
  next{left: 2, right: 3}; {}
4 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
8 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
13 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
17 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
5 from 4: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
9 from 8: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
14 from 13: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
18 from 17: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
  (); {P1: 1, P2: 2, P3: 3}
20 from 18: (); {P1: 1, P2: 2, P3: 3}. Join(P3)
  (); {P1: 1, P2: 2, P3: 3}
main_choice_1 from 20: (); {P1: 1, P2: 2, P3: 3}. Subst({from: P1, to: P3})
  main_choice_1{from: 1, to: 3}; {P1: 1, P2: 2, P3: 3}
2 from main_choice_1: main_choice_1{from: 1, to: 3}; {P1: 1, P2: 2, P3: 3}. Match(main_choice_1{from: P1, to: P2}; {P1: P1, P3: P2})
  main_choice_1{from: 1, to: 3}; {P1: 1, P2: 3}
0 from 2: main_choice_1{from: 1, to: 3}; {P1: 1, P2: 3}. Union
  main_choice_1{from: 1, to: 3}; {P1: 1, P2: 3}
main from 0: main_choice_1{from: 1, to: 3}; {P1: 1, P2: 3}. Subst({from: P1, to: P2})
  main{from: 1, to: 3}; {P1: 1, P2: 3}
