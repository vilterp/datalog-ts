main :- "foo".
--
foo
----
text/plain
source from null: source{char: "\n", id: 0}; {}. 
  source{char: "\n", id: 0}; {}
0 from source: source{char: "\n", id: 0}; {}. Match(source{char: "f", id: P1}; {})
3 from source: source{char: "\n", id: 0}; {}. Match(source{char: "o", id: P2}; {})
7 from source: source{char: "\n", id: 0}; {}. Match(source{char: "o", id: P3}; {})
--
source from null: source{char: "f", id: 1}; {}. 
  source{char: "f", id: 1}; {}
0 from source: source{char: "f", id: 1}; {}. Match(source{char: "f", id: P1}; {})
  source{char: "f", id: 1}; {P1: 1}
3 from source: source{char: "f", id: 1}; {}. Match(source{char: "o", id: P2}; {})
7 from source: source{char: "f", id: 1}; {}. Match(source{char: "o", id: P3}; {})
2 from 0: source{char: "f", id: 1}; {P1: 1}. Join(P1)
--
source from null: source{char: "o", id: 2}; {}. 
  source{char: "o", id: 2}; {}
0 from source: source{char: "o", id: 2}; {}. Match(source{char: "f", id: P1}; {})
3 from source: source{char: "o", id: 2}; {}. Match(source{char: "o", id: P2}; {})
  source{char: "o", id: 2}; {P2: 2}
7 from source: source{char: "o", id: 2}; {}. Match(source{char: "o", id: P3}; {})
  source{char: "o", id: 2}; {P3: 2}
4 from 3: source{char: "o", id: 2}; {P2: 2}. Join(P2)
8 from 7: source{char: "o", id: 2}; {P3: 2}. Join(P3)
--
source from null: source{char: "o", id: 3}; {}. 
  source{char: "o", id: 3}; {}
0 from source: source{char: "o", id: 3}; {}. Match(source{char: "f", id: P1}; {})
3 from source: source{char: "o", id: 3}; {}. Match(source{char: "o", id: P2}; {})
  source{char: "o", id: 3}; {P2: 3}
7 from source: source{char: "o", id: 3}; {}. Match(source{char: "o", id: P3}; {})
  source{char: "o", id: 3}; {P3: 3}
4 from 3: source{char: "o", id: 3}; {P2: 3}. Join(P2)
8 from 7: source{char: "o", id: 3}; {P3: 3}. Join(P3)
--
next from null: next{left: 0, right: 1}; {}. 
  next{left: 0, right: 1}; {}
1 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
5 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
9 from next: next{left: 0, right: 1}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 0, right: 1}; {P3: 0, P4: 1}
2 from 1: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
6 from 5: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
10 from 9: next{left: 0, right: 1}; {P3: 0, P4: 1}. Join(P3)
--
next from null: next{left: 1, right: 2}; {}. 
  next{left: 1, right: 2}; {}
1 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
5 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
9 from next: next{left: 1, right: 2}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 1, right: 2}; {P3: 1, P4: 2}
2 from 1: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
  (); {P1: 1, P2: 2}
6 from 5: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
10 from 9: next{left: 1, right: 2}; {P3: 1, P4: 2}. Join(P3)
4 from 2: (); {P1: 1, P2: 2}. Join(P2)
  (); {P1: 1, P2: 2}
6 from 4: (); {P1: 1, P2: 2}. Join(P2)
--
next from null: next{left: 2, right: 3}; {}. 
  next{left: 2, right: 3}; {}
1 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
5 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
9 from next: next{left: 2, right: 3}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 2, right: 3}; {P3: 2, P4: 3}
2 from 1: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
6 from 5: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
  (); {P1: 1, P2: 2, P3: 3}
10 from 9: next{left: 2, right: 3}; {P3: 2, P4: 3}. Join(P3)
8 from 6: (); {P1: 1, P2: 2, P3: 3}. Join(P3)
  (); {P1: 1, P2: 2, P3: 3}
10 from 8: (); {P1: 1, P2: 2, P3: 3}. Join(P3)
--
next from null: next{left: 3, right: "end"}; {}. 
  next{left: 3, right: "end"}; {}
1 from next: next{left: 3, right: "end"}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 3, right: "end"}; {P1: 3, P2: "end"}
5 from next: next{left: 3, right: "end"}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 3, right: "end"}; {P2: 3, P3: "end"}
9 from next: next{left: 3, right: "end"}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 3, right: "end"}; {P3: 3, P4: "end"}
2 from 1: next{left: 3, right: "end"}; {P1: 3, P2: "end"}. Join(P1)
6 from 5: next{left: 3, right: "end"}; {P2: 3, P3: "end"}. Join(P2)
10 from 9: next{left: 3, right: "end"}; {P3: 3, P4: "end"}. Join(P3)
  (); {P1: 1, P2: 2, P3: 3, P4: "end"}
main from 10: (); {P1: 1, P2: 2, P3: 3, P4: "end"}. Subst({span: span{from: P1, to: P4}})
  main{span: span{from: 1, to: "end"}}; {P1: 1, P2: 2, P3: 3, P4: "end"}

main :- ["foo", "bar"].
--
foobar
----
text/plain
source from null: source{char: "\n", id: 0}; {}. 
  source{char: "\n", id: 0}; {}
3 from source: source{char: "\n", id: 0}; {}. Match(source{char: "f", id: P1}; {})
6 from source: source{char: "\n", id: 0}; {}. Match(source{char: "o", id: P2}; {})
10 from source: source{char: "\n", id: 0}; {}. Match(source{char: "o", id: P3}; {})
14 from source: source{char: "\n", id: 0}; {}. Match(source{char: "b", id: P1}; {})
17 from source: source{char: "\n", id: 0}; {}. Match(source{char: "a", id: P2}; {})
21 from source: source{char: "\n", id: 0}; {}. Match(source{char: "r", id: P3}; {})
--
source from null: source{char: "f", id: 1}; {}. 
  source{char: "f", id: 1}; {}
3 from source: source{char: "f", id: 1}; {}. Match(source{char: "f", id: P1}; {})
  source{char: "f", id: 1}; {P1: 1}
6 from source: source{char: "f", id: 1}; {}. Match(source{char: "o", id: P2}; {})
10 from source: source{char: "f", id: 1}; {}. Match(source{char: "o", id: P3}; {})
14 from source: source{char: "f", id: 1}; {}. Match(source{char: "b", id: P1}; {})
17 from source: source{char: "f", id: 1}; {}. Match(source{char: "a", id: P2}; {})
21 from source: source{char: "f", id: 1}; {}. Match(source{char: "r", id: P3}; {})
5 from 3: source{char: "f", id: 1}; {P1: 1}. Join(P1)
--
source from null: source{char: "o", id: 2}; {}. 
  source{char: "o", id: 2}; {}
3 from source: source{char: "o", id: 2}; {}. Match(source{char: "f", id: P1}; {})
6 from source: source{char: "o", id: 2}; {}. Match(source{char: "o", id: P2}; {})
  source{char: "o", id: 2}; {P2: 2}
10 from source: source{char: "o", id: 2}; {}. Match(source{char: "o", id: P3}; {})
  source{char: "o", id: 2}; {P3: 2}
14 from source: source{char: "o", id: 2}; {}. Match(source{char: "b", id: P1}; {})
17 from source: source{char: "o", id: 2}; {}. Match(source{char: "a", id: P2}; {})
21 from source: source{char: "o", id: 2}; {}. Match(source{char: "r", id: P3}; {})
7 from 6: source{char: "o", id: 2}; {P2: 2}. Join(P2)
11 from 10: source{char: "o", id: 2}; {P3: 2}. Join(P3)
--
source from null: source{char: "o", id: 3}; {}. 
  source{char: "o", id: 3}; {}
3 from source: source{char: "o", id: 3}; {}. Match(source{char: "f", id: P1}; {})
6 from source: source{char: "o", id: 3}; {}. Match(source{char: "o", id: P2}; {})
  source{char: "o", id: 3}; {P2: 3}
10 from source: source{char: "o", id: 3}; {}. Match(source{char: "o", id: P3}; {})
  source{char: "o", id: 3}; {P3: 3}
14 from source: source{char: "o", id: 3}; {}. Match(source{char: "b", id: P1}; {})
17 from source: source{char: "o", id: 3}; {}. Match(source{char: "a", id: P2}; {})
21 from source: source{char: "o", id: 3}; {}. Match(source{char: "r", id: P3}; {})
7 from 6: source{char: "o", id: 3}; {P2: 3}. Join(P2)
11 from 10: source{char: "o", id: 3}; {P3: 3}. Join(P3)
--
source from null: source{char: "b", id: 4}; {}. 
  source{char: "b", id: 4}; {}
3 from source: source{char: "b", id: 4}; {}. Match(source{char: "f", id: P1}; {})
6 from source: source{char: "b", id: 4}; {}. Match(source{char: "o", id: P2}; {})
10 from source: source{char: "b", id: 4}; {}. Match(source{char: "o", id: P3}; {})
14 from source: source{char: "b", id: 4}; {}. Match(source{char: "b", id: P1}; {})
  source{char: "b", id: 4}; {P1: 4}
17 from source: source{char: "b", id: 4}; {}. Match(source{char: "a", id: P2}; {})
21 from source: source{char: "b", id: 4}; {}. Match(source{char: "r", id: P3}; {})
16 from 14: source{char: "b", id: 4}; {P1: 4}. Join(P1)
--
source from null: source{char: "a", id: 5}; {}. 
  source{char: "a", id: 5}; {}
3 from source: source{char: "a", id: 5}; {}. Match(source{char: "f", id: P1}; {})
6 from source: source{char: "a", id: 5}; {}. Match(source{char: "o", id: P2}; {})
10 from source: source{char: "a", id: 5}; {}. Match(source{char: "o", id: P3}; {})
14 from source: source{char: "a", id: 5}; {}. Match(source{char: "b", id: P1}; {})
17 from source: source{char: "a", id: 5}; {}. Match(source{char: "a", id: P2}; {})
  source{char: "a", id: 5}; {P2: 5}
21 from source: source{char: "a", id: 5}; {}. Match(source{char: "r", id: P3}; {})
18 from 17: source{char: "a", id: 5}; {P2: 5}. Join(P2)
--
source from null: source{char: "r", id: 6}; {}. 
  source{char: "r", id: 6}; {}
3 from source: source{char: "r", id: 6}; {}. Match(source{char: "f", id: P1}; {})
6 from source: source{char: "r", id: 6}; {}. Match(source{char: "o", id: P2}; {})
10 from source: source{char: "r", id: 6}; {}. Match(source{char: "o", id: P3}; {})
14 from source: source{char: "r", id: 6}; {}. Match(source{char: "b", id: P1}; {})
17 from source: source{char: "r", id: 6}; {}. Match(source{char: "a", id: P2}; {})
21 from source: source{char: "r", id: 6}; {}. Match(source{char: "r", id: P3}; {})
  source{char: "r", id: 6}; {P3: 6}
22 from 21: source{char: "r", id: 6}; {P3: 6}. Join(P3)
--
next from null: next{left: 0, right: 1}; {}. 
  next{left: 0, right: 1}; {}
4 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
8 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
12 from next: next{left: 0, right: 1}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 0, right: 1}; {P3: 0, P4: 1}
15 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
19 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
23 from next: next{left: 0, right: 1}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 0, right: 1}; {P3: 0, P4: 1}
5 from 4: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
9 from 8: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
13 from 12: next{left: 0, right: 1}; {P3: 0, P4: 1}. Join(P3)
16 from 15: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
20 from 19: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
24 from 23: next{left: 0, right: 1}; {P3: 0, P4: 1}. Join(P3)
--
next from null: next{left: 1, right: 2}; {}. 
  next{left: 1, right: 2}; {}
4 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
8 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
12 from next: next{left: 1, right: 2}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 1, right: 2}; {P3: 1, P4: 2}
15 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
19 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
23 from next: next{left: 1, right: 2}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 1, right: 2}; {P3: 1, P4: 2}
5 from 4: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
  (); {P1: 1, P2: 2}
9 from 8: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
13 from 12: next{left: 1, right: 2}; {P3: 1, P4: 2}. Join(P3)
16 from 15: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
20 from 19: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
24 from 23: next{left: 1, right: 2}; {P3: 1, P4: 2}. Join(P3)
7 from 5: (); {P1: 1, P2: 2}. Join(P2)
  (); {P1: 1, P2: 2}
9 from 7: (); {P1: 1, P2: 2}. Join(P2)
--
next from null: next{left: 2, right: 3}; {}. 
  next{left: 2, right: 3}; {}
4 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
8 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
12 from next: next{left: 2, right: 3}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 2, right: 3}; {P3: 2, P4: 3}
15 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
19 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
23 from next: next{left: 2, right: 3}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 2, right: 3}; {P3: 2, P4: 3}
5 from 4: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
9 from 8: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
  (); {P1: 1, P2: 2, P3: 3}
13 from 12: next{left: 2, right: 3}; {P3: 2, P4: 3}. Join(P3)
16 from 15: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
20 from 19: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
24 from 23: next{left: 2, right: 3}; {P3: 2, P4: 3}. Join(P3)
11 from 9: (); {P1: 1, P2: 2, P3: 3}. Join(P3)
  (); {P1: 1, P2: 2, P3: 3}
13 from 11: (); {P1: 1, P2: 2, P3: 3}. Join(P3)
--
next from null: next{left: 3, right: 4}; {}. 
  next{left: 3, right: 4}; {}
4 from next: next{left: 3, right: 4}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 3, right: 4}; {P1: 3, P2: 4}
8 from next: next{left: 3, right: 4}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 3, right: 4}; {P2: 3, P3: 4}
12 from next: next{left: 3, right: 4}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 3, right: 4}; {P3: 3, P4: 4}
15 from next: next{left: 3, right: 4}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 3, right: 4}; {P1: 3, P2: 4}
19 from next: next{left: 3, right: 4}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 3, right: 4}; {P2: 3, P3: 4}
23 from next: next{left: 3, right: 4}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 3, right: 4}; {P3: 3, P4: 4}
5 from 4: next{left: 3, right: 4}; {P1: 3, P2: 4}. Join(P1)
9 from 8: next{left: 3, right: 4}; {P2: 3, P3: 4}. Join(P2)
13 from 12: next{left: 3, right: 4}; {P3: 3, P4: 4}. Join(P3)
  (); {P1: 1, P2: 2, P3: 3, P4: 4}
16 from 15: next{left: 3, right: 4}; {P1: 3, P2: 4}. Join(P1)
20 from 19: next{left: 3, right: 4}; {P2: 3, P3: 4}. Join(P2)
24 from 23: next{left: 3, right: 4}; {P3: 3, P4: 4}. Join(P3)
main_seq_0 from 13: (); {P1: 1, P2: 2, P3: 3, P4: 4}. Subst({span: span{from: P1, to: P4}})
  main_seq_0{span: span{from: 1, to: 4}}; {P1: 1, P2: 2, P3: 3, P4: 4}
0 from main_seq_0: main_seq_0{span: span{from: 1, to: 4}}; {P1: 1, P2: 2, P3: 3, P4: 4}. Match(main_seq_0{span: span{from: P0, to: P1}}; {})
  main_seq_0{span: span{from: 1, to: 4}}; {P0: 1, P1: 4}
2 from 0: main_seq_0{span: span{from: 1, to: 4}}; {P0: 1, P1: 4}. Join(P1)
--
next from null: next{left: 4, right: 5}; {}. 
  next{left: 4, right: 5}; {}
4 from next: next{left: 4, right: 5}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 4, right: 5}; {P1: 4, P2: 5}
8 from next: next{left: 4, right: 5}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 4, right: 5}; {P2: 4, P3: 5}
12 from next: next{left: 4, right: 5}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 4, right: 5}; {P3: 4, P4: 5}
15 from next: next{left: 4, right: 5}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 4, right: 5}; {P1: 4, P2: 5}
19 from next: next{left: 4, right: 5}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 4, right: 5}; {P2: 4, P3: 5}
23 from next: next{left: 4, right: 5}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 4, right: 5}; {P3: 4, P4: 5}
5 from 4: next{left: 4, right: 5}; {P1: 4, P2: 5}. Join(P1)
9 from 8: next{left: 4, right: 5}; {P2: 4, P3: 5}. Join(P2)
13 from 12: next{left: 4, right: 5}; {P3: 4, P4: 5}. Join(P3)
16 from 15: next{left: 4, right: 5}; {P1: 4, P2: 5}. Join(P1)
  (); {P1: 4, P2: 5}
20 from 19: next{left: 4, right: 5}; {P2: 4, P3: 5}. Join(P2)
24 from 23: next{left: 4, right: 5}; {P3: 4, P4: 5}. Join(P3)
18 from 16: (); {P1: 4, P2: 5}. Join(P2)
  (); {P1: 4, P2: 5}
20 from 18: (); {P1: 4, P2: 5}. Join(P2)
--
next from null: next{left: 5, right: 6}; {}. 
  next{left: 5, right: 6}; {}
4 from next: next{left: 5, right: 6}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 5, right: 6}; {P1: 5, P2: 6}
8 from next: next{left: 5, right: 6}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 5, right: 6}; {P2: 5, P3: 6}
12 from next: next{left: 5, right: 6}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 5, right: 6}; {P3: 5, P4: 6}
15 from next: next{left: 5, right: 6}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 5, right: 6}; {P1: 5, P2: 6}
19 from next: next{left: 5, right: 6}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 5, right: 6}; {P2: 5, P3: 6}
23 from next: next{left: 5, right: 6}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 5, right: 6}; {P3: 5, P4: 6}
5 from 4: next{left: 5, right: 6}; {P1: 5, P2: 6}. Join(P1)
9 from 8: next{left: 5, right: 6}; {P2: 5, P3: 6}. Join(P2)
13 from 12: next{left: 5, right: 6}; {P3: 5, P4: 6}. Join(P3)
16 from 15: next{left: 5, right: 6}; {P1: 5, P2: 6}. Join(P1)
20 from 19: next{left: 5, right: 6}; {P2: 5, P3: 6}. Join(P2)
  (); {P1: 4, P2: 5, P3: 6}
24 from 23: next{left: 5, right: 6}; {P3: 5, P4: 6}. Join(P3)
22 from 20: (); {P1: 4, P2: 5, P3: 6}. Join(P3)
  (); {P1: 4, P2: 5, P3: 6}
24 from 22: (); {P1: 4, P2: 5, P3: 6}. Join(P3)
--
next from null: next{left: 6, right: "end"}; {}. 
  next{left: 6, right: "end"}; {}
4 from next: next{left: 6, right: "end"}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 6, right: "end"}; {P1: 6, P2: "end"}
8 from next: next{left: 6, right: "end"}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 6, right: "end"}; {P2: 6, P3: "end"}
12 from next: next{left: 6, right: "end"}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 6, right: "end"}; {P3: 6, P4: "end"}
15 from next: next{left: 6, right: "end"}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 6, right: "end"}; {P1: 6, P2: "end"}
19 from next: next{left: 6, right: "end"}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 6, right: "end"}; {P2: 6, P3: "end"}
23 from next: next{left: 6, right: "end"}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 6, right: "end"}; {P3: 6, P4: "end"}
5 from 4: next{left: 6, right: "end"}; {P1: 6, P2: "end"}. Join(P1)
9 from 8: next{left: 6, right: "end"}; {P2: 6, P3: "end"}. Join(P2)
13 from 12: next{left: 6, right: "end"}; {P3: 6, P4: "end"}. Join(P3)
16 from 15: next{left: 6, right: "end"}; {P1: 6, P2: "end"}. Join(P1)
20 from 19: next{left: 6, right: "end"}; {P2: 6, P3: "end"}. Join(P2)
24 from 23: next{left: 6, right: "end"}; {P3: 6, P4: "end"}. Join(P3)
  (); {P1: 4, P2: 5, P3: 6, P4: "end"}
main_seq_1 from 24: (); {P1: 4, P2: 5, P3: 6, P4: "end"}. Subst({span: span{from: P1, to: P4}})
  main_seq_1{span: span{from: 4, to: "end"}}; {P1: 4, P2: 5, P3: 6, P4: "end"}
1 from main_seq_1: main_seq_1{span: span{from: 4, to: "end"}}; {P1: 4, P2: 5, P3: 6, P4: "end"}. Match(main_seq_1{span: span{from: P1, to: P2}}; {})
  main_seq_1{span: span{from: 4, to: "end"}}; {P1: 4, P2: "end"}
2 from 1: main_seq_1{span: span{from: 4, to: "end"}}; {P1: 4, P2: "end"}. Join(P1)
  (); {P0: 1, P1: 4, P2: "end"}
main from 2: (); {P0: 1, P1: 4, P2: "end"}. Subst({seq_0: span{from: P0, to: P1}, seq_1: span{from: P1, to: P2}, span: span{from: P1, to: P2}})
  main{seq_0: span{from: 1, to: 4}, seq_1: span{from: 4, to: "end"}, span: span{from: 4, to: "end"}}; {P0: 1, P1: 4, P2: "end"}

main :- ("foo" | "bar").
--
foo
----
text/plain
source from null: source{char: "\n", id: 0}; {}. 
  source{char: "\n", id: 0}; {}
3 from source: source{char: "\n", id: 0}; {}. Match(source{char: "f", id: P1}; {})
6 from source: source{char: "\n", id: 0}; {}. Match(source{char: "o", id: P2}; {})
10 from source: source{char: "\n", id: 0}; {}. Match(source{char: "o", id: P3}; {})
14 from source: source{char: "\n", id: 0}; {}. Match(source{char: "b", id: P1}; {})
17 from source: source{char: "\n", id: 0}; {}. Match(source{char: "a", id: P2}; {})
21 from source: source{char: "\n", id: 0}; {}. Match(source{char: "r", id: P3}; {})
--
source from null: source{char: "f", id: 1}; {}. 
  source{char: "f", id: 1}; {}
3 from source: source{char: "f", id: 1}; {}. Match(source{char: "f", id: P1}; {})
  source{char: "f", id: 1}; {P1: 1}
6 from source: source{char: "f", id: 1}; {}. Match(source{char: "o", id: P2}; {})
10 from source: source{char: "f", id: 1}; {}. Match(source{char: "o", id: P3}; {})
14 from source: source{char: "f", id: 1}; {}. Match(source{char: "b", id: P1}; {})
17 from source: source{char: "f", id: 1}; {}. Match(source{char: "a", id: P2}; {})
21 from source: source{char: "f", id: 1}; {}. Match(source{char: "r", id: P3}; {})
5 from 3: source{char: "f", id: 1}; {P1: 1}. Join(P1)
--
source from null: source{char: "o", id: 2}; {}. 
  source{char: "o", id: 2}; {}
3 from source: source{char: "o", id: 2}; {}. Match(source{char: "f", id: P1}; {})
6 from source: source{char: "o", id: 2}; {}. Match(source{char: "o", id: P2}; {})
  source{char: "o", id: 2}; {P2: 2}
10 from source: source{char: "o", id: 2}; {}. Match(source{char: "o", id: P3}; {})
  source{char: "o", id: 2}; {P3: 2}
14 from source: source{char: "o", id: 2}; {}. Match(source{char: "b", id: P1}; {})
17 from source: source{char: "o", id: 2}; {}. Match(source{char: "a", id: P2}; {})
21 from source: source{char: "o", id: 2}; {}. Match(source{char: "r", id: P3}; {})
7 from 6: source{char: "o", id: 2}; {P2: 2}. Join(P2)
11 from 10: source{char: "o", id: 2}; {P3: 2}. Join(P3)
--
source from null: source{char: "o", id: 3}; {}. 
  source{char: "o", id: 3}; {}
3 from source: source{char: "o", id: 3}; {}. Match(source{char: "f", id: P1}; {})
6 from source: source{char: "o", id: 3}; {}. Match(source{char: "o", id: P2}; {})
  source{char: "o", id: 3}; {P2: 3}
10 from source: source{char: "o", id: 3}; {}. Match(source{char: "o", id: P3}; {})
  source{char: "o", id: 3}; {P3: 3}
14 from source: source{char: "o", id: 3}; {}. Match(source{char: "b", id: P1}; {})
17 from source: source{char: "o", id: 3}; {}. Match(source{char: "a", id: P2}; {})
21 from source: source{char: "o", id: 3}; {}. Match(source{char: "r", id: P3}; {})
7 from 6: source{char: "o", id: 3}; {P2: 3}. Join(P2)
11 from 10: source{char: "o", id: 3}; {P3: 3}. Join(P3)
--
next from null: next{left: 0, right: 1}; {}. 
  next{left: 0, right: 1}; {}
4 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
8 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
12 from next: next{left: 0, right: 1}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 0, right: 1}; {P3: 0, P4: 1}
15 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
19 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
23 from next: next{left: 0, right: 1}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 0, right: 1}; {P3: 0, P4: 1}
5 from 4: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
9 from 8: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
13 from 12: next{left: 0, right: 1}; {P3: 0, P4: 1}. Join(P3)
16 from 15: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
20 from 19: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
24 from 23: next{left: 0, right: 1}; {P3: 0, P4: 1}. Join(P3)
--
next from null: next{left: 1, right: 2}; {}. 
  next{left: 1, right: 2}; {}
4 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
8 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
12 from next: next{left: 1, right: 2}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 1, right: 2}; {P3: 1, P4: 2}
15 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
19 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
23 from next: next{left: 1, right: 2}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 1, right: 2}; {P3: 1, P4: 2}
5 from 4: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
  (); {P1: 1, P2: 2}
9 from 8: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
13 from 12: next{left: 1, right: 2}; {P3: 1, P4: 2}. Join(P3)
16 from 15: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
20 from 19: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
24 from 23: next{left: 1, right: 2}; {P3: 1, P4: 2}. Join(P3)
7 from 5: (); {P1: 1, P2: 2}. Join(P2)
  (); {P1: 1, P2: 2}
9 from 7: (); {P1: 1, P2: 2}. Join(P2)
--
next from null: next{left: 2, right: 3}; {}. 
  next{left: 2, right: 3}; {}
4 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
8 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
12 from next: next{left: 2, right: 3}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 2, right: 3}; {P3: 2, P4: 3}
15 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
19 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
23 from next: next{left: 2, right: 3}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 2, right: 3}; {P3: 2, P4: 3}
5 from 4: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
9 from 8: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
  (); {P1: 1, P2: 2, P3: 3}
13 from 12: next{left: 2, right: 3}; {P3: 2, P4: 3}. Join(P3)
16 from 15: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
20 from 19: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
24 from 23: next{left: 2, right: 3}; {P3: 2, P4: 3}. Join(P3)
11 from 9: (); {P1: 1, P2: 2, P3: 3}. Join(P3)
  (); {P1: 1, P2: 2, P3: 3}
13 from 11: (); {P1: 1, P2: 2, P3: 3}. Join(P3)
--
next from null: next{left: 3, right: "end"}; {}. 
  next{left: 3, right: "end"}; {}
4 from next: next{left: 3, right: "end"}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 3, right: "end"}; {P1: 3, P2: "end"}
8 from next: next{left: 3, right: "end"}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 3, right: "end"}; {P2: 3, P3: "end"}
12 from next: next{left: 3, right: "end"}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 3, right: "end"}; {P3: 3, P4: "end"}
15 from next: next{left: 3, right: "end"}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 3, right: "end"}; {P1: 3, P2: "end"}
19 from next: next{left: 3, right: "end"}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 3, right: "end"}; {P2: 3, P3: "end"}
23 from next: next{left: 3, right: "end"}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 3, right: "end"}; {P3: 3, P4: "end"}
5 from 4: next{left: 3, right: "end"}; {P1: 3, P2: "end"}. Join(P1)
9 from 8: next{left: 3, right: "end"}; {P2: 3, P3: "end"}. Join(P2)
13 from 12: next{left: 3, right: "end"}; {P3: 3, P4: "end"}. Join(P3)
  (); {P1: 1, P2: 2, P3: 3, P4: "end"}
16 from 15: next{left: 3, right: "end"}; {P1: 3, P2: "end"}. Join(P1)
20 from 19: next{left: 3, right: "end"}; {P2: 3, P3: "end"}. Join(P2)
24 from 23: next{left: 3, right: "end"}; {P3: 3, P4: "end"}. Join(P3)
main_choice_0 from 13: (); {P1: 1, P2: 2, P3: 3, P4: "end"}. Subst({span: span{from: P1, to: P4}})
  main_choice_0{span: span{from: 1, to: "end"}}; {P1: 1, P2: 2, P3: 3, P4: "end"}
1 from main_choice_0: main_choice_0{span: span{from: 1, to: "end"}}; {P1: 1, P2: 2, P3: 3, P4: "end"}. Match(main_choice_0{span: span{from: P1, to: P2}}; {})
  main_choice_0{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}
0 from 1: main_choice_0{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}. Union
  main_choice_0{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}
main from 0: main_choice_0{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}. Subst({span: span{from: P1, to: P2}})
  main{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}

main :- ("foo" | "bar").
--
bar
----
text/plain
source from null: source{char: "\n", id: 0}; {}. 
  source{char: "\n", id: 0}; {}
3 from source: source{char: "\n", id: 0}; {}. Match(source{char: "f", id: P1}; {})
6 from source: source{char: "\n", id: 0}; {}. Match(source{char: "o", id: P2}; {})
10 from source: source{char: "\n", id: 0}; {}. Match(source{char: "o", id: P3}; {})
14 from source: source{char: "\n", id: 0}; {}. Match(source{char: "b", id: P1}; {})
17 from source: source{char: "\n", id: 0}; {}. Match(source{char: "a", id: P2}; {})
21 from source: source{char: "\n", id: 0}; {}. Match(source{char: "r", id: P3}; {})
--
source from null: source{char: "b", id: 1}; {}. 
  source{char: "b", id: 1}; {}
3 from source: source{char: "b", id: 1}; {}. Match(source{char: "f", id: P1}; {})
6 from source: source{char: "b", id: 1}; {}. Match(source{char: "o", id: P2}; {})
10 from source: source{char: "b", id: 1}; {}. Match(source{char: "o", id: P3}; {})
14 from source: source{char: "b", id: 1}; {}. Match(source{char: "b", id: P1}; {})
  source{char: "b", id: 1}; {P1: 1}
17 from source: source{char: "b", id: 1}; {}. Match(source{char: "a", id: P2}; {})
21 from source: source{char: "b", id: 1}; {}. Match(source{char: "r", id: P3}; {})
16 from 14: source{char: "b", id: 1}; {P1: 1}. Join(P1)
--
source from null: source{char: "a", id: 2}; {}. 
  source{char: "a", id: 2}; {}
3 from source: source{char: "a", id: 2}; {}. Match(source{char: "f", id: P1}; {})
6 from source: source{char: "a", id: 2}; {}. Match(source{char: "o", id: P2}; {})
10 from source: source{char: "a", id: 2}; {}. Match(source{char: "o", id: P3}; {})
14 from source: source{char: "a", id: 2}; {}. Match(source{char: "b", id: P1}; {})
17 from source: source{char: "a", id: 2}; {}. Match(source{char: "a", id: P2}; {})
  source{char: "a", id: 2}; {P2: 2}
21 from source: source{char: "a", id: 2}; {}. Match(source{char: "r", id: P3}; {})
18 from 17: source{char: "a", id: 2}; {P2: 2}. Join(P2)
--
source from null: source{char: "r", id: 3}; {}. 
  source{char: "r", id: 3}; {}
3 from source: source{char: "r", id: 3}; {}. Match(source{char: "f", id: P1}; {})
6 from source: source{char: "r", id: 3}; {}. Match(source{char: "o", id: P2}; {})
10 from source: source{char: "r", id: 3}; {}. Match(source{char: "o", id: P3}; {})
14 from source: source{char: "r", id: 3}; {}. Match(source{char: "b", id: P1}; {})
17 from source: source{char: "r", id: 3}; {}. Match(source{char: "a", id: P2}; {})
21 from source: source{char: "r", id: 3}; {}. Match(source{char: "r", id: P3}; {})
  source{char: "r", id: 3}; {P3: 3}
22 from 21: source{char: "r", id: 3}; {P3: 3}. Join(P3)
--
next from null: next{left: 0, right: 1}; {}. 
  next{left: 0, right: 1}; {}
4 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
8 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
12 from next: next{left: 0, right: 1}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 0, right: 1}; {P3: 0, P4: 1}
15 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
19 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
23 from next: next{left: 0, right: 1}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 0, right: 1}; {P3: 0, P4: 1}
5 from 4: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
9 from 8: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
13 from 12: next{left: 0, right: 1}; {P3: 0, P4: 1}. Join(P3)
16 from 15: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
20 from 19: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
24 from 23: next{left: 0, right: 1}; {P3: 0, P4: 1}. Join(P3)
--
next from null: next{left: 1, right: 2}; {}. 
  next{left: 1, right: 2}; {}
4 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
8 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
12 from next: next{left: 1, right: 2}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 1, right: 2}; {P3: 1, P4: 2}
15 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
19 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
23 from next: next{left: 1, right: 2}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 1, right: 2}; {P3: 1, P4: 2}
5 from 4: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
9 from 8: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
13 from 12: next{left: 1, right: 2}; {P3: 1, P4: 2}. Join(P3)
16 from 15: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
  (); {P1: 1, P2: 2}
20 from 19: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
24 from 23: next{left: 1, right: 2}; {P3: 1, P4: 2}. Join(P3)
18 from 16: (); {P1: 1, P2: 2}. Join(P2)
  (); {P1: 1, P2: 2}
20 from 18: (); {P1: 1, P2: 2}. Join(P2)
--
next from null: next{left: 2, right: 3}; {}. 
  next{left: 2, right: 3}; {}
4 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
8 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
12 from next: next{left: 2, right: 3}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 2, right: 3}; {P3: 2, P4: 3}
15 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
19 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
23 from next: next{left: 2, right: 3}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 2, right: 3}; {P3: 2, P4: 3}
5 from 4: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
9 from 8: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
13 from 12: next{left: 2, right: 3}; {P3: 2, P4: 3}. Join(P3)
16 from 15: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
20 from 19: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
  (); {P1: 1, P2: 2, P3: 3}
24 from 23: next{left: 2, right: 3}; {P3: 2, P4: 3}. Join(P3)
22 from 20: (); {P1: 1, P2: 2, P3: 3}. Join(P3)
  (); {P1: 1, P2: 2, P3: 3}
24 from 22: (); {P1: 1, P2: 2, P3: 3}. Join(P3)
--
next from null: next{left: 3, right: "end"}; {}. 
  next{left: 3, right: "end"}; {}
4 from next: next{left: 3, right: "end"}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 3, right: "end"}; {P1: 3, P2: "end"}
8 from next: next{left: 3, right: "end"}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 3, right: "end"}; {P2: 3, P3: "end"}
12 from next: next{left: 3, right: "end"}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 3, right: "end"}; {P3: 3, P4: "end"}
15 from next: next{left: 3, right: "end"}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 3, right: "end"}; {P1: 3, P2: "end"}
19 from next: next{left: 3, right: "end"}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 3, right: "end"}; {P2: 3, P3: "end"}
23 from next: next{left: 3, right: "end"}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 3, right: "end"}; {P3: 3, P4: "end"}
5 from 4: next{left: 3, right: "end"}; {P1: 3, P2: "end"}. Join(P1)
9 from 8: next{left: 3, right: "end"}; {P2: 3, P3: "end"}. Join(P2)
13 from 12: next{left: 3, right: "end"}; {P3: 3, P4: "end"}. Join(P3)
16 from 15: next{left: 3, right: "end"}; {P1: 3, P2: "end"}. Join(P1)
20 from 19: next{left: 3, right: "end"}; {P2: 3, P3: "end"}. Join(P2)
24 from 23: next{left: 3, right: "end"}; {P3: 3, P4: "end"}. Join(P3)
  (); {P1: 1, P2: 2, P3: 3, P4: "end"}
main_choice_1 from 24: (); {P1: 1, P2: 2, P3: 3, P4: "end"}. Subst({span: span{from: P1, to: P4}})
  main_choice_1{span: span{from: 1, to: "end"}}; {P1: 1, P2: 2, P3: 3, P4: "end"}
2 from main_choice_1: main_choice_1{span: span{from: 1, to: "end"}}; {P1: 1, P2: 2, P3: 3, P4: "end"}. Match(main_choice_1{span: span{from: P1, to: P2}}; {})
  main_choice_1{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}
0 from 2: main_choice_1{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}. Union
  main_choice_1{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}
main from 0: main_choice_1{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}. Subst({span: span{from: P1, to: P2}})
  main{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}

main :- (foo | bar).
foo :- "foo".
bar :- "bar".
--
foo
----
text/plain
source from null: source{char: "\n", id: 0}; {}. 
  source{char: "\n", id: 0}; {}
0 from source: source{char: "\n", id: 0}; {}. Match(source{char: "b", id: P1}; {})
3 from source: source{char: "\n", id: 0}; {}. Match(source{char: "a", id: P2}; {})
7 from source: source{char: "\n", id: 0}; {}. Match(source{char: "r", id: P3}; {})
11 from source: source{char: "\n", id: 0}; {}. Match(source{char: "f", id: P1}; {})
14 from source: source{char: "\n", id: 0}; {}. Match(source{char: "o", id: P2}; {})
18 from source: source{char: "\n", id: 0}; {}. Match(source{char: "o", id: P3}; {})
--
source from null: source{char: "f", id: 1}; {}. 
  source{char: "f", id: 1}; {}
0 from source: source{char: "f", id: 1}; {}. Match(source{char: "b", id: P1}; {})
3 from source: source{char: "f", id: 1}; {}. Match(source{char: "a", id: P2}; {})
7 from source: source{char: "f", id: 1}; {}. Match(source{char: "r", id: P3}; {})
11 from source: source{char: "f", id: 1}; {}. Match(source{char: "f", id: P1}; {})
  source{char: "f", id: 1}; {P1: 1}
14 from source: source{char: "f", id: 1}; {}. Match(source{char: "o", id: P2}; {})
18 from source: source{char: "f", id: 1}; {}. Match(source{char: "o", id: P3}; {})
13 from 11: source{char: "f", id: 1}; {P1: 1}. Join(P1)
--
source from null: source{char: "o", id: 2}; {}. 
  source{char: "o", id: 2}; {}
0 from source: source{char: "o", id: 2}; {}. Match(source{char: "b", id: P1}; {})
3 from source: source{char: "o", id: 2}; {}. Match(source{char: "a", id: P2}; {})
7 from source: source{char: "o", id: 2}; {}. Match(source{char: "r", id: P3}; {})
11 from source: source{char: "o", id: 2}; {}. Match(source{char: "f", id: P1}; {})
14 from source: source{char: "o", id: 2}; {}. Match(source{char: "o", id: P2}; {})
  source{char: "o", id: 2}; {P2: 2}
18 from source: source{char: "o", id: 2}; {}. Match(source{char: "o", id: P3}; {})
  source{char: "o", id: 2}; {P3: 2}
15 from 14: source{char: "o", id: 2}; {P2: 2}. Join(P2)
19 from 18: source{char: "o", id: 2}; {P3: 2}. Join(P3)
--
source from null: source{char: "o", id: 3}; {}. 
  source{char: "o", id: 3}; {}
0 from source: source{char: "o", id: 3}; {}. Match(source{char: "b", id: P1}; {})
3 from source: source{char: "o", id: 3}; {}. Match(source{char: "a", id: P2}; {})
7 from source: source{char: "o", id: 3}; {}. Match(source{char: "r", id: P3}; {})
11 from source: source{char: "o", id: 3}; {}. Match(source{char: "f", id: P1}; {})
14 from source: source{char: "o", id: 3}; {}. Match(source{char: "o", id: P2}; {})
  source{char: "o", id: 3}; {P2: 3}
18 from source: source{char: "o", id: 3}; {}. Match(source{char: "o", id: P3}; {})
  source{char: "o", id: 3}; {P3: 3}
15 from 14: source{char: "o", id: 3}; {P2: 3}. Join(P2)
19 from 18: source{char: "o", id: 3}; {P3: 3}. Join(P3)
--
next from null: next{left: 0, right: 1}; {}. 
  next{left: 0, right: 1}; {}
1 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
5 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
9 from next: next{left: 0, right: 1}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 0, right: 1}; {P3: 0, P4: 1}
12 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
16 from next: next{left: 0, right: 1}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 0, right: 1}; {P2: 0, P3: 1}
20 from next: next{left: 0, right: 1}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 0, right: 1}; {P3: 0, P4: 1}
2 from 1: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
6 from 5: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
10 from 9: next{left: 0, right: 1}; {P3: 0, P4: 1}. Join(P3)
13 from 12: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
17 from 16: next{left: 0, right: 1}; {P2: 0, P3: 1}. Join(P2)
21 from 20: next{left: 0, right: 1}; {P3: 0, P4: 1}. Join(P3)
--
next from null: next{left: 1, right: 2}; {}. 
  next{left: 1, right: 2}; {}
1 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
5 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
9 from next: next{left: 1, right: 2}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 1, right: 2}; {P3: 1, P4: 2}
12 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
16 from next: next{left: 1, right: 2}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 1, right: 2}; {P2: 1, P3: 2}
20 from next: next{left: 1, right: 2}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 1, right: 2}; {P3: 1, P4: 2}
2 from 1: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
6 from 5: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
10 from 9: next{left: 1, right: 2}; {P3: 1, P4: 2}. Join(P3)
13 from 12: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
  (); {P1: 1, P2: 2}
17 from 16: next{left: 1, right: 2}; {P2: 1, P3: 2}. Join(P2)
21 from 20: next{left: 1, right: 2}; {P3: 1, P4: 2}. Join(P3)
15 from 13: (); {P1: 1, P2: 2}. Join(P2)
  (); {P1: 1, P2: 2}
17 from 15: (); {P1: 1, P2: 2}. Join(P2)
--
next from null: next{left: 2, right: 3}; {}. 
  next{left: 2, right: 3}; {}
1 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
5 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
9 from next: next{left: 2, right: 3}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 2, right: 3}; {P3: 2, P4: 3}
12 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
16 from next: next{left: 2, right: 3}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 2, right: 3}; {P2: 2, P3: 3}
20 from next: next{left: 2, right: 3}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 2, right: 3}; {P3: 2, P4: 3}
2 from 1: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
6 from 5: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
10 from 9: next{left: 2, right: 3}; {P3: 2, P4: 3}. Join(P3)
13 from 12: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
17 from 16: next{left: 2, right: 3}; {P2: 2, P3: 3}. Join(P2)
  (); {P1: 1, P2: 2, P3: 3}
21 from 20: next{left: 2, right: 3}; {P3: 2, P4: 3}. Join(P3)
19 from 17: (); {P1: 1, P2: 2, P3: 3}. Join(P3)
  (); {P1: 1, P2: 2, P3: 3}
21 from 19: (); {P1: 1, P2: 2, P3: 3}. Join(P3)
--
next from null: next{left: 3, right: "end"}; {}. 
  next{left: 3, right: "end"}; {}
1 from next: next{left: 3, right: "end"}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 3, right: "end"}; {P1: 3, P2: "end"}
5 from next: next{left: 3, right: "end"}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 3, right: "end"}; {P2: 3, P3: "end"}
9 from next: next{left: 3, right: "end"}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 3, right: "end"}; {P3: 3, P4: "end"}
12 from next: next{left: 3, right: "end"}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 3, right: "end"}; {P1: 3, P2: "end"}
16 from next: next{left: 3, right: "end"}; {}. Match(next{left: P2, right: P3}; {})
  next{left: 3, right: "end"}; {P2: 3, P3: "end"}
20 from next: next{left: 3, right: "end"}; {}. Match(next{left: P3, right: P4}; {})
  next{left: 3, right: "end"}; {P3: 3, P4: "end"}
2 from 1: next{left: 3, right: "end"}; {P1: 3, P2: "end"}. Join(P1)
6 from 5: next{left: 3, right: "end"}; {P2: 3, P3: "end"}. Join(P2)
10 from 9: next{left: 3, right: "end"}; {P3: 3, P4: "end"}. Join(P3)
13 from 12: next{left: 3, right: "end"}; {P1: 3, P2: "end"}. Join(P1)
17 from 16: next{left: 3, right: "end"}; {P2: 3, P3: "end"}. Join(P2)
21 from 20: next{left: 3, right: "end"}; {P3: 3, P4: "end"}. Join(P3)
  (); {P1: 1, P2: 2, P3: 3, P4: "end"}
foo from 21: (); {P1: 1, P2: 2, P3: 3, P4: "end"}. Subst({span: span{from: P1, to: P4}})
  foo{span: span{from: 1, to: "end"}}; {P1: 1, P2: 2, P3: 3, P4: "end"}
25 from foo: foo{span: span{from: 1, to: "end"}}; {P1: 1, P2: 2, P3: 3, P4: "end"}. Match(foo{span: span{from: P1, to: P2}}; {})
  foo{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}
main_choice_0 from 25: foo{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}. Subst({span: span{from: P1, to: P2}})
  main_choice_0{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}
23 from main_choice_0: main_choice_0{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}. Match(main_choice_0{span: span{from: P1, to: P2}}; {})
  main_choice_0{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}
22 from 23: main_choice_0{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}. Union
  main_choice_0{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}
main from 22: main_choice_0{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}. Subst({span: span{from: P1, to: P2}})
  main{span: span{from: 1, to: "end"}}; {P1: 1, P2: "end"}

main :- repSep("a", <succeed>).
--
aaa
----
text/plain
source from null: source{char: "\n", id: 0}; {}. 
  source{char: "\n", id: 0}; {}
5 from source: source{char: "\n", id: 0}; {}. Match(source{char: "a", id: P1}; {})
--
source from null: source{char: "a", id: 1}; {}. 
  source{char: "a", id: 1}; {}
5 from source: source{char: "a", id: 1}; {}. Match(source{char: "a", id: P1}; {})
  source{char: "a", id: 1}; {P1: 1}
7 from 5: source{char: "a", id: 1}; {P1: 1}. Join(P1)
--
source from null: source{char: "a", id: 2}; {}. 
  source{char: "a", id: 2}; {}
5 from source: source{char: "a", id: 2}; {}. Match(source{char: "a", id: P1}; {})
  source{char: "a", id: 2}; {P1: 2}
7 from 5: source{char: "a", id: 2}; {P1: 2}. Join(P1)
--
source from null: source{char: "a", id: 3}; {}. 
  source{char: "a", id: 3}; {}
5 from source: source{char: "a", id: 3}; {}. Match(source{char: "a", id: P1}; {})
  source{char: "a", id: 3}; {P1: 3}
7 from 5: source{char: "a", id: 3}; {P1: 3}. Join(P1)
--
next from null: next{left: 0, right: 1}; {}. 
  next{left: 0, right: 1}; {}
6 from next: next{left: 0, right: 1}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 0, right: 1}; {P1: 0, P2: 1}
7 from 6: next{left: 0, right: 1}; {P1: 0, P2: 1}. Join(P1)
--
next from null: next{left: 1, right: 2}; {}. 
  next{left: 1, right: 2}; {}
6 from next: next{left: 1, right: 2}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 1, right: 2}; {P1: 1, P2: 2}
7 from 6: next{left: 1, right: 2}; {P1: 1, P2: 2}. Join(P1)
  (); {P1: 1, P2: 2}
main_item from 7: (); {P1: 1, P2: 2}. Subst({span: span{from: P1, to: P2}})
  main_item{span: span{from: 1, to: 2}}; {P1: 1, P2: 2}
1 from main_item: main_item{span: span{from: 1, to: 2}}; {P1: 1, P2: 2}. Match(main_item{span: span{from: P1, to: PN}}; {})
  main_item{span: span{from: 1, to: 2}}; {P1: 1, PN: 2}
2 from main_item: main_item{span: span{from: 1, to: 2}}; {P1: 1, P2: 2}. Match(main_item{span: span{from: P1, to: P2}}; {})
  main_item{span: span{from: 1, to: 2}}; {P1: 1, P2: 2}
0 from 1: main_item{span: span{from: 1, to: 2}}; {P1: 1, PN: 2}. Union
  main_item{span: span{from: 1, to: 2}}; {P1: 1, PN: 2}
4 from 2: main_item{span: span{from: 1, to: 2}}; {P1: 1, P2: 2}. Join(P2)
main from 0: main_item{span: span{from: 1, to: 2}}; {P1: 1, PN: 2}. Subst({span: span{from: P1, to: PN}})
  main{span: span{from: 1, to: 2}}; {P1: 1, PN: 2}
3 from main: main{span: span{from: 1, to: 2}}; {P1: 1, PN: 2}. Match(main{span: span{from: P2, to: PN}}; {})
  main{span: span{from: 1, to: 2}}; {P2: 1, PN: 2}
4 from 3: main{span: span{from: 1, to: 2}}; {P2: 1, PN: 2}. Join(P2)
--
next from null: next{left: 2, right: 3}; {}. 
  next{left: 2, right: 3}; {}
6 from next: next{left: 2, right: 3}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 2, right: 3}; {P1: 2, P2: 3}
7 from 6: next{left: 2, right: 3}; {P1: 2, P2: 3}. Join(P1)
  (); {P1: 2, P2: 3}
main_item from 7: (); {P1: 2, P2: 3}. Subst({span: span{from: P1, to: P2}})
  main_item{span: span{from: 2, to: 3}}; {P1: 2, P2: 3}
1 from main_item: main_item{span: span{from: 2, to: 3}}; {P1: 2, P2: 3}. Match(main_item{span: span{from: P1, to: PN}}; {})
  main_item{span: span{from: 2, to: 3}}; {P1: 2, PN: 3}
2 from main_item: main_item{span: span{from: 2, to: 3}}; {P1: 2, P2: 3}. Match(main_item{span: span{from: P1, to: P2}}; {})
  main_item{span: span{from: 2, to: 3}}; {P1: 2, P2: 3}
0 from 1: main_item{span: span{from: 2, to: 3}}; {P1: 2, PN: 3}. Union
  main_item{span: span{from: 2, to: 3}}; {P1: 2, PN: 3}
4 from 2: main_item{span: span{from: 2, to: 3}}; {P1: 2, P2: 3}. Join(P2)
main from 0: main_item{span: span{from: 2, to: 3}}; {P1: 2, PN: 3}. Subst({span: span{from: P1, to: PN}})
  main{span: span{from: 2, to: 3}}; {P1: 2, PN: 3}
3 from main: main{span: span{from: 2, to: 3}}; {P1: 2, PN: 3}. Match(main{span: span{from: P2, to: PN}}; {})
  main{span: span{from: 2, to: 3}}; {P2: 2, PN: 3}
4 from 3: main{span: span{from: 2, to: 3}}; {P2: 2, PN: 3}. Join(P2)
  (); {P1: 1, P2: 2, PN: 3}
0 from 4: (); {P1: 1, P2: 2, PN: 3}. Union
  (); {P1: 1, P2: 2, PN: 3}
main from 0: (); {P1: 1, P2: 2, PN: 3}. Subst({span: span{from: P1, to: PN}})
  main{span: span{from: 1, to: 3}}; {P1: 1, P2: 2, PN: 3}
3 from main: main{span: span{from: 1, to: 3}}; {P1: 1, P2: 2, PN: 3}. Match(main{span: span{from: P2, to: PN}}; {})
  main{span: span{from: 1, to: 3}}; {P2: 1, PN: 3}
4 from 3: main{span: span{from: 1, to: 3}}; {P2: 1, PN: 3}. Join(P2)
--
next from null: next{left: 3, right: "end"}; {}. 
  next{left: 3, right: "end"}; {}
6 from next: next{left: 3, right: "end"}; {}. Match(next{left: P1, right: P2}; {})
  next{left: 3, right: "end"}; {P1: 3, P2: "end"}
7 from 6: next{left: 3, right: "end"}; {P1: 3, P2: "end"}. Join(P1)
  (); {P1: 3, P2: "end"}
main_item from 7: (); {P1: 3, P2: "end"}. Subst({span: span{from: P1, to: P2}})
  main_item{span: span{from: 3, to: "end"}}; {P1: 3, P2: "end"}
1 from main_item: main_item{span: span{from: 3, to: "end"}}; {P1: 3, P2: "end"}. Match(main_item{span: span{from: P1, to: PN}}; {})
  main_item{span: span{from: 3, to: "end"}}; {P1: 3, PN: "end"}
2 from main_item: main_item{span: span{from: 3, to: "end"}}; {P1: 3, P2: "end"}. Match(main_item{span: span{from: P1, to: P2}}; {})
  main_item{span: span{from: 3, to: "end"}}; {P1: 3, P2: "end"}
0 from 1: main_item{span: span{from: 3, to: "end"}}; {P1: 3, PN: "end"}. Union
  main_item{span: span{from: 3, to: "end"}}; {P1: 3, PN: "end"}
4 from 2: main_item{span: span{from: 3, to: "end"}}; {P1: 3, P2: "end"}. Join(P2)
main from 0: main_item{span: span{from: 3, to: "end"}}; {P1: 3, PN: "end"}. Subst({span: span{from: P1, to: PN}})
  main{span: span{from: 3, to: "end"}}; {P1: 3, PN: "end"}
3 from main: main{span: span{from: 3, to: "end"}}; {P1: 3, PN: "end"}. Match(main{span: span{from: P2, to: PN}}; {})
  main{span: span{from: 3, to: "end"}}; {P2: 3, PN: "end"}
4 from 3: main{span: span{from: 3, to: "end"}}; {P2: 3, PN: "end"}. Join(P2)
  (); {P1: 2, P2: 3, PN: "end"}
0 from 4: (); {P1: 2, P2: 3, PN: "end"}. Union
  (); {P1: 2, P2: 3, PN: "end"}
main from 0: (); {P1: 2, P2: 3, PN: "end"}. Subst({span: span{from: P1, to: PN}})
  main{span: span{from: 2, to: "end"}}; {P1: 2, P2: 3, PN: "end"}
3 from main: main{span: span{from: 2, to: "end"}}; {P1: 2, P2: 3, PN: "end"}. Match(main{span: span{from: P2, to: PN}}; {})
  main{span: span{from: 2, to: "end"}}; {P2: 2, PN: "end"}
4 from 3: main{span: span{from: 2, to: "end"}}; {P2: 2, PN: "end"}. Join(P2)
  (); {P1: 1, P2: 2, PN: "end"}
0 from 4: (); {P1: 1, P2: 2, PN: "end"}. Union
  (); {P1: 1, P2: 2, PN: "end"}
main from 0: (); {P1: 1, P2: 2, PN: "end"}. Subst({span: span{from: P1, to: PN}})
  main{span: span{from: 1, to: "end"}}; {P1: 1, P2: 2, PN: "end"}
3 from main: main{span: span{from: 1, to: "end"}}; {P1: 1, P2: 2, PN: "end"}. Match(main{span: span{from: P2, to: PN}}; {})
  main{span: span{from: 1, to: "end"}}; {P2: 1, PN: "end"}
4 from 3: main{span: span{from: 1, to: "end"}}; {P2: 1, PN: "end"}. Join(P2)
