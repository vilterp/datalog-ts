main :- "foo".
----
application/graphviz
digraph G {
  "0" [fillcolor="darkseagreen2" label="0: Match(source{char: \"f\", id: P1}; {}) [P1]" shape="box" style="filled"];
  "1" [fillcolor="darkseagreen2" label="1: Match(next{left: P1, right: P2}; {}) [P1]" shape="box" style="filled"];
  "2" [fillcolor="thistle" label="2: Join(P1) [P2]" shape="box" style="filled"];
  "3" [fillcolor="darkseagreen2" label="3: Match(source{char: \"o\", id: P2}; {}) [P2]" shape="box" style="filled"];
  "4" [fillcolor="thistle" label="4: Join(P2) [P2]" shape="box" style="filled"];
  "5" [fillcolor="darkseagreen2" label="5: Match(next{left: P2, right: P3}; {}) [P2]" shape="box" style="filled"];
  "6" [fillcolor="thistle" label="6: Join(P2) [P3]" shape="box" style="filled"];
  "7" [fillcolor="darkseagreen2" label="7: Match(source{char: \"o\", id: P3}; {}) [P3]" shape="box" style="filled"];
  "8" [fillcolor="thistle" label="8: Join(P3) []" shape="box" style="filled"];
  "source" [fillcolor="darksalmon" label="source:  []" shape="box" style="filled"];
  "next" [fillcolor="darksalmon" label="next:  []" shape="box" style="filled"];
  "main" [fillcolor="lightblue" label="main: Subst({span: span{from: P1, to: P3}}) []" shape="box" style="filled"];
  "0" -> "2" [];
  "1" -> "2" [];
  "2" -> "4" [];
  "3" -> "4" [];
  "4" -> "6" [];
  "5" -> "6" [];
  "6" -> "8" [];
  "7" -> "8" [];
  "8" -> "main" [];
  "next" -> "1" [];
  "next" -> "5" [];
  "source" -> "0" [];
  "source" -> "3" [];
  "source" -> "7" [];
}

main :- ["foo", "bar"].
----
application/graphviz
digraph G {
  "0" [fillcolor="darkseagreen2" label="0: Match(main_seq_1{span: span{from: P3, to: P4}}; {}) [P3]" shape="box" style="filled"];
  "1" [fillcolor="darkseagreen2" label="1: Match(next{left: P2, right: P3}; {}) [P3]" shape="box" style="filled"];
  "2" [fillcolor="thistle" label="2: Join(P3) [P2]" shape="box" style="filled"];
  "3" [fillcolor="darkseagreen2" label="3: Match(main_seq_0{span: span{from: P1, to: P2}}; {}) [P2]" shape="box" style="filled"];
  "4" [fillcolor="thistle" label="4: Join(P2) []" shape="box" style="filled"];
  "5" [fillcolor="darkseagreen2" label="5: Match(source{char: \"f\", id: P1}; {}) [P1]" shape="box" style="filled"];
  "6" [fillcolor="darkseagreen2" label="6: Match(next{left: P1, right: P2}; {}) [P1]" shape="box" style="filled"];
  "7" [fillcolor="thistle" label="7: Join(P1) [P2]" shape="box" style="filled"];
  "8" [fillcolor="darkseagreen2" label="8: Match(source{char: \"o\", id: P2}; {}) [P2]" shape="box" style="filled"];
  "9" [fillcolor="thistle" label="9: Join(P2) [P2]" shape="box" style="filled"];
  "10" [fillcolor="darkseagreen2" label="10: Match(next{left: P2, right: P3}; {}) [P2]" shape="box" style="filled"];
  "11" [fillcolor="thistle" label="11: Join(P2) [P3]" shape="box" style="filled"];
  "12" [fillcolor="darkseagreen2" label="12: Match(source{char: \"o\", id: P3}; {}) [P3]" shape="box" style="filled"];
  "13" [fillcolor="thistle" label="13: Join(P3) []" shape="box" style="filled"];
  "14" [fillcolor="darkseagreen2" label="14: Match(source{char: \"b\", id: P1}; {}) [P1]" shape="box" style="filled"];
  "15" [fillcolor="darkseagreen2" label="15: Match(next{left: P1, right: P2}; {}) [P1]" shape="box" style="filled"];
  "16" [fillcolor="thistle" label="16: Join(P1) [P2]" shape="box" style="filled"];
  "17" [fillcolor="darkseagreen2" label="17: Match(source{char: \"a\", id: P2}; {}) [P2]" shape="box" style="filled"];
  "18" [fillcolor="thistle" label="18: Join(P2) [P2]" shape="box" style="filled"];
  "19" [fillcolor="darkseagreen2" label="19: Match(next{left: P2, right: P3}; {}) [P2]" shape="box" style="filled"];
  "20" [fillcolor="thistle" label="20: Join(P2) [P3]" shape="box" style="filled"];
  "21" [fillcolor="darkseagreen2" label="21: Match(source{char: \"r\", id: P3}; {}) [P3]" shape="box" style="filled"];
  "22" [fillcolor="thistle" label="22: Join(P3) []" shape="box" style="filled"];
  "source" [fillcolor="darksalmon" label="source:  []" shape="box" style="filled"];
  "next" [fillcolor="darksalmon" label="next:  []" shape="box" style="filled"];
  "main" [fillcolor="lightblue" label="main: Subst({seq_0: span{from: P1, to: P2}, seq_1: span{from: P3, to: P4}, span: span{from: P1, to: P4}}) []" shape="box" style="filled"];
  "main_seq_0" [fillcolor="lightblue" label="main_seq_0: Subst({span: span{from: P1, to: P3}}) []" shape="box" style="filled"];
  "main_seq_1" [fillcolor="lightblue" label="main_seq_1: Subst({span: span{from: P1, to: P3}}) []" shape="box" style="filled"];
  "0" -> "2" [];
  "1" -> "2" [];
  "10" -> "11" [];
  "11" -> "13" [];
  "12" -> "13" [];
  "13" -> "main_seq_0" [];
  "14" -> "16" [];
  "15" -> "16" [];
  "16" -> "18" [];
  "17" -> "18" [];
  "18" -> "20" [];
  "19" -> "20" [];
  "2" -> "4" [];
  "20" -> "22" [];
  "21" -> "22" [];
  "22" -> "main_seq_1" [];
  "3" -> "4" [];
  "4" -> "main" [];
  "5" -> "7" [];
  "6" -> "7" [];
  "7" -> "9" [];
  "8" -> "9" [];
  "9" -> "11" [];
  "main_seq_0" -> "3" [];
  "main_seq_1" -> "0" [];
  "next" -> "1" [];
  "next" -> "6" [];
  "next" -> "10" [];
  "next" -> "15" [];
  "next" -> "19" [];
  "source" -> "5" [];
  "source" -> "8" [];
  "source" -> "12" [];
  "source" -> "14" [];
  "source" -> "17" [];
  "source" -> "21" [];
}

main :- ("foo" | "bar").
----
application/graphviz
digraph G {
  "0" [fillcolor="moccasin" label="0: Union []" shape="box" style="filled"];
  "1" [fillcolor="darkseagreen2" label="1: Match(main_choice_0{span: span{from: P1, to: P2}}; {}) []" shape="box" style="filled"];
  "2" [fillcolor="darkseagreen2" label="2: Match(main_choice_1{span: span{from: P1, to: P2}}; {}) []" shape="box" style="filled"];
  "3" [fillcolor="darkseagreen2" label="3: Match(source{char: \"f\", id: P1}; {}) [P1]" shape="box" style="filled"];
  "4" [fillcolor="darkseagreen2" label="4: Match(next{left: P1, right: P2}; {}) [P1]" shape="box" style="filled"];
  "5" [fillcolor="thistle" label="5: Join(P1) [P2]" shape="box" style="filled"];
  "6" [fillcolor="darkseagreen2" label="6: Match(source{char: \"o\", id: P2}; {}) [P2]" shape="box" style="filled"];
  "7" [fillcolor="thistle" label="7: Join(P2) [P2]" shape="box" style="filled"];
  "8" [fillcolor="darkseagreen2" label="8: Match(next{left: P2, right: P3}; {}) [P2]" shape="box" style="filled"];
  "9" [fillcolor="thistle" label="9: Join(P2) [P3]" shape="box" style="filled"];
  "10" [fillcolor="darkseagreen2" label="10: Match(source{char: \"o\", id: P3}; {}) [P3]" shape="box" style="filled"];
  "11" [fillcolor="thistle" label="11: Join(P3) []" shape="box" style="filled"];
  "12" [fillcolor="darkseagreen2" label="12: Match(source{char: \"b\", id: P1}; {}) [P1]" shape="box" style="filled"];
  "13" [fillcolor="darkseagreen2" label="13: Match(next{left: P1, right: P2}; {}) [P1]" shape="box" style="filled"];
  "14" [fillcolor="thistle" label="14: Join(P1) [P2]" shape="box" style="filled"];
  "15" [fillcolor="darkseagreen2" label="15: Match(source{char: \"a\", id: P2}; {}) [P2]" shape="box" style="filled"];
  "16" [fillcolor="thistle" label="16: Join(P2) [P2]" shape="box" style="filled"];
  "17" [fillcolor="darkseagreen2" label="17: Match(next{left: P2, right: P3}; {}) [P2]" shape="box" style="filled"];
  "18" [fillcolor="thistle" label="18: Join(P2) [P3]" shape="box" style="filled"];
  "19" [fillcolor="darkseagreen2" label="19: Match(source{char: \"r\", id: P3}; {}) [P3]" shape="box" style="filled"];
  "20" [fillcolor="thistle" label="20: Join(P3) []" shape="box" style="filled"];
  "source" [fillcolor="darksalmon" label="source:  []" shape="box" style="filled"];
  "next" [fillcolor="darksalmon" label="next:  []" shape="box" style="filled"];
  "main" [fillcolor="lightblue" label="main: Subst({span: span{from: P1, to: P2}}) []" shape="box" style="filled"];
  "main_choice_0" [fillcolor="lightblue" label="main_choice_0: Subst({span: span{from: P1, to: P3}}) []" shape="box" style="filled"];
  "main_choice_1" [fillcolor="lightblue" label="main_choice_1: Subst({span: span{from: P1, to: P3}}) []" shape="box" style="filled"];
  "0" -> "main" [];
  "1" -> "0" [];
  "10" -> "11" [];
  "11" -> "main_choice_0" [];
  "12" -> "14" [];
  "13" -> "14" [];
  "14" -> "16" [];
  "15" -> "16" [];
  "16" -> "18" [];
  "17" -> "18" [];
  "18" -> "20" [];
  "19" -> "20" [];
  "2" -> "0" [];
  "20" -> "main_choice_1" [];
  "3" -> "5" [];
  "4" -> "5" [];
  "5" -> "7" [];
  "6" -> "7" [];
  "7" -> "9" [];
  "8" -> "9" [];
  "9" -> "11" [];
  "main_choice_0" -> "1" [];
  "main_choice_1" -> "2" [];
  "next" -> "4" [];
  "next" -> "8" [];
  "next" -> "13" [];
  "next" -> "17" [];
  "source" -> "3" [];
  "source" -> "6" [];
  "source" -> "10" [];
  "source" -> "12" [];
  "source" -> "15" [];
  "source" -> "19" [];
}

main :- (foo | bar).
foo :- "foo".
bar :- "bar".
----
application/graphviz
digraph G {
  "0" [fillcolor="darkseagreen2" label="0: Match(source{char: \"b\", id: P1}; {}) [P1]" shape="box" style="filled"];
  "1" [fillcolor="darkseagreen2" label="1: Match(next{left: P1, right: P2}; {}) [P1]" shape="box" style="filled"];
  "2" [fillcolor="thistle" label="2: Join(P1) [P2]" shape="box" style="filled"];
  "3" [fillcolor="darkseagreen2" label="3: Match(source{char: \"a\", id: P2}; {}) [P2]" shape="box" style="filled"];
  "4" [fillcolor="thistle" label="4: Join(P2) [P2]" shape="box" style="filled"];
  "5" [fillcolor="darkseagreen2" label="5: Match(next{left: P2, right: P3}; {}) [P2]" shape="box" style="filled"];
  "6" [fillcolor="thistle" label="6: Join(P2) [P3]" shape="box" style="filled"];
  "7" [fillcolor="darkseagreen2" label="7: Match(source{char: \"r\", id: P3}; {}) [P3]" shape="box" style="filled"];
  "8" [fillcolor="thistle" label="8: Join(P3) []" shape="box" style="filled"];
  "9" [fillcolor="darkseagreen2" label="9: Match(source{char: \"f\", id: P1}; {}) [P1]" shape="box" style="filled"];
  "10" [fillcolor="darkseagreen2" label="10: Match(next{left: P1, right: P2}; {}) [P1]" shape="box" style="filled"];
  "11" [fillcolor="thistle" label="11: Join(P1) [P2]" shape="box" style="filled"];
  "12" [fillcolor="darkseagreen2" label="12: Match(source{char: \"o\", id: P2}; {}) [P2]" shape="box" style="filled"];
  "13" [fillcolor="thistle" label="13: Join(P2) [P2]" shape="box" style="filled"];
  "14" [fillcolor="darkseagreen2" label="14: Match(next{left: P2, right: P3}; {}) [P2]" shape="box" style="filled"];
  "15" [fillcolor="thistle" label="15: Join(P2) [P3]" shape="box" style="filled"];
  "16" [fillcolor="darkseagreen2" label="16: Match(source{char: \"o\", id: P3}; {}) [P3]" shape="box" style="filled"];
  "17" [fillcolor="thistle" label="17: Join(P3) []" shape="box" style="filled"];
  "18" [fillcolor="moccasin" label="18: Union []" shape="box" style="filled"];
  "19" [fillcolor="darkseagreen2" label="19: Match(main_choice_0{span: span{from: P1, to: P2}}; {}) []" shape="box" style="filled"];
  "20" [fillcolor="darkseagreen2" label="20: Match(main_choice_1{span: span{from: P1, to: P2}}; {}) []" shape="box" style="filled"];
  "21" [fillcolor="darkseagreen2" label="21: Match(foo{span: span{from: P1, to: P2}}; {}) []" shape="box" style="filled"];
  "22" [fillcolor="darkseagreen2" label="22: Match(bar{span: span{from: P1, to: P2}}; {}) []" shape="box" style="filled"];
  "source" [fillcolor="darksalmon" label="source:  []" shape="box" style="filled"];
  "next" [fillcolor="darksalmon" label="next:  []" shape="box" style="filled"];
  "bar" [fillcolor="lightblue" label="bar: Subst({span: span{from: P1, to: P3}}) []" shape="box" style="filled"];
  "foo" [fillcolor="lightblue" label="foo: Subst({span: span{from: P1, to: P3}}) []" shape="box" style="filled"];
  "main" [fillcolor="lightblue" label="main: Subst({span: span{from: P1, to: P2}}) []" shape="box" style="filled"];
  "main_choice_0" [fillcolor="lightblue" label="main_choice_0: Subst({span: span{from: P1, to: P2}}) []" shape="box" style="filled"];
  "main_choice_1" [fillcolor="lightblue" label="main_choice_1: Subst({span: span{from: P1, to: P2}}) []" shape="box" style="filled"];
  "0" -> "2" [];
  "1" -> "2" [];
  "10" -> "11" [];
  "11" -> "13" [];
  "12" -> "13" [];
  "13" -> "15" [];
  "14" -> "15" [];
  "15" -> "17" [];
  "16" -> "17" [];
  "17" -> "foo" [];
  "18" -> "main" [];
  "19" -> "18" [];
  "2" -> "4" [];
  "20" -> "18" [];
  "21" -> "main_choice_0" [];
  "22" -> "main_choice_1" [];
  "3" -> "4" [];
  "4" -> "6" [];
  "5" -> "6" [];
  "6" -> "8" [];
  "7" -> "8" [];
  "8" -> "bar" [];
  "9" -> "11" [];
  "bar" -> "22" [];
  "foo" -> "21" [];
  "main_choice_0" -> "19" [];
  "main_choice_1" -> "20" [];
  "next" -> "1" [];
  "next" -> "5" [];
  "next" -> "10" [];
  "next" -> "14" [];
  "source" -> "0" [];
  "source" -> "3" [];
  "source" -> "7" [];
  "source" -> "9" [];
  "source" -> "12" [];
  "source" -> "16" [];
}
