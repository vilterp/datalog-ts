main :- ["foo", "bar"].
----
application/datalog
main{seq_0: span{from: P1, to: P2}, seq_1: span{from: P3, to: P4}, span: span{from: P1, to: P4}} :- 
  main_seq_0{span: span{from: P1, to: P2}} &
  main_seq_1{span: span{from: P3, to: P4}} &
  next{left: P2, right: P3}
main_seq_0{span: span{from: P1, to: P3}} :- 
  source{char: "f", id: P1} &
  source{char: "o", id: P2} &
  source{char: "o", id: P3} &
  next{left: P1, right: P2} &
  next{left: P2, right: P3}
main_seq_1{span: span{from: P1, to: P3}} :- 
  source{char: "b", id: P1} &
  source{char: "a", id: P2} &
  source{char: "r", id: P3} &
  next{left: P1, right: P2} &
  next{left: P2, right: P3}

main :- repSep("foo", "bar").
----
application/datalog
main{span: span{from: P1, to: P6}} :- 
  main_rep{span: span{from: P1, to: P6}} |
  main_rep{span: span{from: P1, to: P2}} &
  next{left: P2, right: P3} &
  main_sep{span: span{from: P3, to: P4}} &
  next{left: P4, right: P5} &
  main{span: span{from: P5, to: P6}}
main_rep{span: span{from: P1, to: P3}} :- 
  source{char: "f", id: P1} &
  source{char: "o", id: P2} &
  source{char: "o", id: P3} &
  next{left: P1, right: P2} &
  next{left: P2, right: P3}
main_sep{span: span{from: P1, to: P3}} :- 
  source{char: "b", id: P1} &
  source{char: "a", id: P2} &
  source{char: "r", id: P3} &
  next{left: P1, right: P2} &
  next{left: P2, right: P3}

main :- value.
value :- (object | array | int | string | null).
int :- [[0-9], repSep([0-9], "")].
object :- ["{", keyValue, "}"].
keyValue :- [string, ":", value].
string :- ["'", repSep([a-z], ""), "'"].
array :- ["[", repSep(value, ","), "]"].
null :- "null".
----
application/datalog
array{seq_0: span{from: P1, to: P2}, seq_1: span{from: P3, to: P4}, seq_2: span{from: P5, to: P6}, span: span{from: P1, to: P6}} :- 
  array_seq_0{span: span{from: P1, to: P2}} &
  array_seq_1{span: span{from: P3, to: P4}} &
  array_seq_2{span: span{from: P5, to: P6}} &
  next{left: P2, right: P3} &
  next{left: P4, right: P5}
array_seq_0{span: span{from: P1, to: P1}} :- source{char: "[", id: P1}
array_seq_1{span: span{from: P1, to: P6}} :- 
  array_seq_1_rep{span: span{from: P1, to: P6}} |
  array_seq_1_rep{span: span{from: P1, to: P2}} &
  next{left: P2, right: P3} &
  array_seq_1_sep{span: span{from: P3, to: P4}} &
  next{left: P4, right: P5} &
  array_seq_1{span: span{from: P5, to: P6}}
array_seq_1_rep{span: span{from: P1, to: P2}} :- value{span: span{from: P1, to: P2}}
array_seq_1_sep{span: span{from: P1, to: P1}} :- source{char: ",", id: P1}
array_seq_2{span: span{from: P1, to: P1}} :- source{char: "]", id: P1}
int{seq_0: span{from: P1, to: P2}, seq_1: span{from: P3, to: P4}, span: span{from: P1, to: P4}} :- 
  int_seq_0{span: span{from: P1, to: P2}} &
  int_seq_1{span: span{from: P3, to: P4}} &
  next{left: P2, right: P3}
int_seq_0{span: span{from: P1, to: P1}} :- source{char: C, id: P1} & "0" <= C & C <= "9"
int_seq_1{span: span{from: P1, to: P6}} :- 
  int_seq_1_rep{span: span{from: P1, to: P6}} |
  int_seq_1_rep{span: span{from: P1, to: P2}} &
  next{left: P2, right: P3} &
  int_seq_1_sep{span: span{from: P3, to: P4}} &
  next{left: P4, right: P5} &
  int_seq_1{span: span{from: P5, to: P6}}
int_seq_1_rep{span: span{from: P1, to: P1}} :- source{char: C, id: P1} & "0" <= C & C <= "9"
int_seq_1_sep{span: span{from: P1, to: P0}} :- 
keyValue{seq_0: span{from: P1, to: P2}, seq_1: span{from: P3, to: P4}, seq_2: span{from: P5, to: P6}, span: span{from: P1, to: P6}} :- 
  keyValue_seq_0{span: span{from: P1, to: P2}} &
  keyValue_seq_1{span: span{from: P3, to: P4}} &
  keyValue_seq_2{span: span{from: P5, to: P6}} &
  next{left: P2, right: P3} &
  next{left: P4, right: P5}
keyValue_seq_0{span: span{from: P1, to: P2}} :- string{span: span{from: P1, to: P2}}
keyValue_seq_1{span: span{from: P1, to: P1}} :- source{char: ":", id: P1}
keyValue_seq_2{span: span{from: P1, to: P2}} :- value{span: span{from: P1, to: P2}}
main{span: span{from: P1, to: P2}} :- value{span: span{from: P1, to: P2}}
null{span: span{from: P1, to: P4}} :- 
  source{char: "n", id: P1} &
  source{char: "u", id: P2} &
  source{char: "l", id: P3} &
  source{char: "l", id: P4} &
  next{left: P1, right: P2} &
  next{left: P2, right: P3} &
  next{left: P3, right: P4}
object{seq_0: span{from: P1, to: P2}, seq_1: span{from: P3, to: P4}, seq_2: span{from: P5, to: P6}, span: span{from: P1, to: P6}} :- 
  object_seq_0{span: span{from: P1, to: P2}} &
  object_seq_1{span: span{from: P3, to: P4}} &
  object_seq_2{span: span{from: P5, to: P6}} &
  next{left: P2, right: P3} &
  next{left: P4, right: P5}
object_seq_0{span: span{from: P1, to: P1}} :- source{char: "{", id: P1}
object_seq_1{span: span{from: P1, to: P2}} :- keyValue{span: span{from: P1, to: P2}}
object_seq_2{span: span{from: P1, to: P1}} :- source{char: "}", id: P1}
string{seq_0: span{from: P1, to: P2}, seq_1: span{from: P3, to: P4}, seq_2: span{from: P5, to: P6}, span: span{from: P1, to: P6}} :- 
  string_seq_0{span: span{from: P1, to: P2}} &
  string_seq_1{span: span{from: P3, to: P4}} &
  string_seq_2{span: span{from: P5, to: P6}} &
  next{left: P2, right: P3} &
  next{left: P4, right: P5}
string_seq_0{span: span{from: P1, to: P1}} :- source{char: "'", id: P1}
string_seq_1{span: span{from: P1, to: P6}} :- 
  string_seq_1_rep{span: span{from: P1, to: P6}} |
  string_seq_1_rep{span: span{from: P1, to: P2}} &
  next{left: P2, right: P3} &
  string_seq_1_sep{span: span{from: P3, to: P4}} &
  next{left: P4, right: P5} &
  string_seq_1{span: span{from: P5, to: P6}}
string_seq_1_rep{span: span{from: P1, to: P1}} :- source{char: C, id: P1} & "a" <= C & C <= "z"
string_seq_1_sep{span: span{from: P1, to: P0}} :- 
string_seq_2{span: span{from: P1, to: P1}} :- source{char: "'", id: P1}
value{span: span{from: P1, to: P2}} :- 
  value_choice_0{span: span{from: P1, to: P2}} |
  value_choice_1{span: span{from: P1, to: P2}} |
  value_choice_2{span: span{from: P1, to: P2}} |
  value_choice_3{span: span{from: P1, to: P2}} |
  value_choice_4{span: span{from: P1, to: P2}}
value_choice_0{span: span{from: P1, to: P2}} :- object{span: span{from: P1, to: P2}}
value_choice_1{span: span{from: P1, to: P2}} :- array{span: span{from: P1, to: P2}}
value_choice_2{span: span{from: P1, to: P2}} :- int{span: span{from: P1, to: P2}}
value_choice_3{span: span{from: P1, to: P2}} :- string{span: span{from: P1, to: P2}}
value_choice_4{span: span{from: P1, to: P2}} :- null{span: span{from: P1, to: P2}}
