scope.Defn{scopeID: I, span: S, name: N, kind: K} :-
  scope.defnRelation{scopeID: I, span: S, name: N, kind: K} |
  scope.defnVar{scopeID: I, span: S, name: N, kind: K}.

scope.defnRelation{scopeID: I, span: S, name: N, kind: K} :-
  scope.declInput{scopeID: I, span: S, name: N, kind: K} |
  scope.declVarRelation{scopeID: I, span: S, name: N, kind: K}.
scope.defnVar{scopeID: I, span: S, name: N, kind: "var"} :-
  scope.varInClause{scope: I, name: N, span: S}.
  # TODO: comparison

scope.varInClause{scope: Constraint, name: N, span: S} :-
  ast.constraint{id: Constraint} &
  ast.clause{id: Clause, parentID: Constraint} &
  ast.record{id: Record, parentID: Clause} &
  ast.recordAttrs{id: Attrs, parentID: Record} &
  ast.recordKeyValue{id: Attr, parentID: Attrs} &
  ast.term{id: Term, parentID: Attr} &
  ast.var{parentID: Term, text: N, span: S}
  |
  ast.constraint{id: Constraint} &
  ast.clause{id: Clause, parentID: Constraint} &
  ast.comparison{id: Comparison, parentID: Clause} &
  ast.term{id: Term, parentID: Comparison} &
  ast.var{parentID: Term, text: N, span: S}.

scope.declInput{scopeID: global{}, span: S, name: N, kind: "relation"} :-
  ast.inputRelation{id: Input} &
  ast.ident{parentID: Input, span: S, text: N}.
scope.declVarRelation{scopeID: global{}, span: S, name: N, kind: "relation"} :-
  ast.varRelation{id: Input} &
  ast.ident{parentID: Input, span: S, text: N}.

scope.Var{scopeID: I, name: N, span: S, kind: K} :-
  scope.varRelation{scopeID: I, name: N, span: S, kind: K} |
  scope.varVar{scopeID: I, name: N, span: S, kind: K}.

scope.varRelation{scopeID: global{}, name: N, span: S, kind: "relation"} :-
  ast.constraint{id: Constraint} &
  ast.clause{id: Clause, parentID: Constraint} &
  ast.record{id: Record, parentID: Clause} &
  ast.ident{parentID: Record, text: N, span: S}.
scope.varVar{scopeID: I, name: N, span: S, kind: "var"} :-
  scope.varInClause{scope: I, name: N, span: S}.

hl.mapping{rule: "ident", type: "ident"}.
hl.mapping{rule: "var", type: "typeParameter"}.
hl.mapping{rule: "int", type: "number"}.
hl.mapping{rule: "bool", type: "number"}.
hl.mapping{rule: "string", type: "string"}.
hl.mapping{rule: "comment", type: "comment"}.
hl.mapping{rule: "varKW", type: "keyword"}.
hl.mapping{rule: "inputKW", type: "keyword"}.
hl.mapping{rule: "stKW", type: "keyword"}.
hl.mapping{rule: "path", type: "string"}.
