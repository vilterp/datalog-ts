var
A
----
application/json
{
  "type": "Var",
  "name": "A"
}

term
A
----
application/json
{
  "type": "Var",
  "name": "A"
}

stringLit
"hello world"
----
application/json
{
  "type": "StringLit",
  "val": "hello world"
}

intLit
2
----
application/json
{
  "type": "IntLit",
  "val": 2
}

intLit
-2
----
application/json
{
  "type": "IntLit",
  "val": -2
}

arrayLit
["foo", Bar, 2, true]
----
application/json
{
  "type": "Array",
  "items": [
    {
      "type": "StringLit",
      "val": "foo"
    },
    {
      "type": "Var",
      "name": "Bar"
    },
    {
      "type": "IntLit",
      "val": 2
    },
    {
      "type": "Bool",
      "val": true
    }
  ]
}

record
foo{bar: B, baz: "bloop"}
----
application/json
{
  "type": "Record",
  "relation": "foo",
  "attrs": {
    "bar": {
      "type": "Var",
      "name": "B"
    },
    "baz": {
      "type": "StringLit",
      "val": "bloop"
    }
  }
}

binExpr
A != B
----
application/json
{
  "type": "BinExpr",
  "left": {
    "type": "Var",
    "name": "A"
  },
  "right": {
    "type": "Var",
    "name": "B"
  },
  "op": "!="
}

statement
.load foo/bar.dl
----
application/json
{
  "type": "LoadStmt",
  "path": "foo/bar.dl"
}

statement
father{child: "Pete", father: "Paul"}.
----
application/json
{
  "type": "Insert",
  "record": {
    "type": "Record",
    "relation": "father",
    "attrs": {
      "child": {
        "type": "StringLit",
        "val": "Pete"
      },
      "father": {
        "type": "StringLit",
        "val": "Paul"
      }
    }
  }
}

statement
parent{child: C, parent: P} :- mother{child: C, mother: P} | father{child: C, father: P}.
----
application/json
{
  "type": "Rule",
  "rule": {
    "head": {
      "type": "Record",
      "relation": "parent",
      "attrs": {
        "child": {
          "type": "Var",
          "name": "C"
        },
        "parent": {
          "type": "Var",
          "name": "P"
        }
      }
    },
    "body": {
      "type": "Or",
      "opts": [
        {
          "type": "And",
          "clauses": [
            {
              "type": "Record",
              "relation": "mother",
              "attrs": {
                "child": {
                  "type": "Var",
                  "name": "C"
                },
                "mother": {
                  "type": "Var",
                  "name": "P"
                }
              }
            }
          ]
        },
        {
          "type": "And",
          "clauses": [
            {
              "type": "Record",
              "relation": "father",
              "attrs": {
                "child": {
                  "type": "Var",
                  "name": "C"
                },
                "father": {
                  "type": "Var",
                  "name": "P"
                }
              }
            }
          ]
        }
      ]
    }
  }
}

statement
grandfather{grandchild: A, grandfather: C} :-
    parent{child: A, parent: B} &
    father{child: B, father: C}.
----
application/json
{
  "type": "Rule",
  "rule": {
    "head": {
      "type": "Record",
      "relation": "grandfather",
      "attrs": {
        "grandchild": {
          "type": "Var",
          "name": "A"
        },
        "grandfather": {
          "type": "Var",
          "name": "C"
        }
      }
    },
    "body": {
      "type": "Or",
      "opts": [
        {
          "type": "And",
          "clauses": [
            {
              "type": "Record",
              "relation": "parent",
              "attrs": {
                "child": {
                  "type": "Var",
                  "name": "A"
                },
                "parent": {
                  "type": "Var",
                  "name": "B"
                }
              }
            },
            {
              "type": "Record",
              "relation": "father",
              "attrs": {
                "child": {
                  "type": "Var",
                  "name": "B"
                },
                "father": {
                  "type": "Var",
                  "name": "C"
                }
              }
            }
          ]
        }
      ]
    }
  }
}

program
father{child: "Pete", father: "Paul"}.
father{child: "Paul", father: "Peter"}.
father{child: "Ann", father: "Peter"}.
father{child: "Mary", father: "Mark"}.
mother{child: "Pete", mother: "Mary"}.
mother{child: "Paul", mother: "Judith"}.
mother{child: "Ann", mother: "Judith"}.
mother{child: "Bob", mother: "Ann"}.
mother{child: "Mary", mother: "Carolyn K"}.
cousin{left: L, right: R} :-
  parent{child: L, mother: P1} &
  sibling{left: P1, right: P2} &
  parent{child: R, parent: P2}.
grandfather{grandchild: A, grandfather: C} :-
  parent{child: A, parent: B} &
  father{child: B, father: C}.
grandmother{grandchild: A, grandmother: C} :-
  child{child: A, parent: B} &
  mother{child: B, mother: C}.
grandparent{grandchild: A, grandparent: C} :-
  parent{child: A, parent: B} &
  parent{child: B, parent: C}.
parent{child: C, parent: P} :- mother{child: C, mother: P} | father{child: C, father: P}.
sibling{left: L, right: R} :-
  mother{child: L, mother: M} &
  father{child: L, father: F} &
  mother{child: R, mother: M} &
  father{child: R, father: F}.
----
application/json
[
  {
    "type": "Insert",
    "record": {
      "type": "Record",
      "relation": "father",
      "attrs": {
        "child": {
          "type": "StringLit",
          "val": "Pete"
        },
        "father": {
          "type": "StringLit",
          "val": "Paul"
        }
      }
    }
  },
  {
    "type": "Insert",
    "record": {
      "type": "Record",
      "relation": "father",
      "attrs": {
        "child": {
          "type": "StringLit",
          "val": "Paul"
        },
        "father": {
          "type": "StringLit",
          "val": "Peter"
        }
      }
    }
  },
  {
    "type": "Insert",
    "record": {
      "type": "Record",
      "relation": "father",
      "attrs": {
        "child": {
          "type": "StringLit",
          "val": "Ann"
        },
        "father": {
          "type": "StringLit",
          "val": "Peter"
        }
      }
    }
  },
  {
    "type": "Insert",
    "record": {
      "type": "Record",
      "relation": "father",
      "attrs": {
        "child": {
          "type": "StringLit",
          "val": "Mary"
        },
        "father": {
          "type": "StringLit",
          "val": "Mark"
        }
      }
    }
  },
  {
    "type": "Insert",
    "record": {
      "type": "Record",
      "relation": "mother",
      "attrs": {
        "child": {
          "type": "StringLit",
          "val": "Pete"
        },
        "mother": {
          "type": "StringLit",
          "val": "Mary"
        }
      }
    }
  },
  {
    "type": "Insert",
    "record": {
      "type": "Record",
      "relation": "mother",
      "attrs": {
        "child": {
          "type": "StringLit",
          "val": "Paul"
        },
        "mother": {
          "type": "StringLit",
          "val": "Judith"
        }
      }
    }
  },
  {
    "type": "Insert",
    "record": {
      "type": "Record",
      "relation": "mother",
      "attrs": {
        "child": {
          "type": "StringLit",
          "val": "Ann"
        },
        "mother": {
          "type": "StringLit",
          "val": "Judith"
        }
      }
    }
  },
  {
    "type": "Insert",
    "record": {
      "type": "Record",
      "relation": "mother",
      "attrs": {
        "child": {
          "type": "StringLit",
          "val": "Bob"
        },
        "mother": {
          "type": "StringLit",
          "val": "Ann"
        }
      }
    }
  },
  {
    "type": "Insert",
    "record": {
      "type": "Record",
      "relation": "mother",
      "attrs": {
        "child": {
          "type": "StringLit",
          "val": "Mary"
        },
        "mother": {
          "type": "StringLit",
          "val": "Carolyn K"
        }
      }
    }
  },
  {
    "type": "Rule",
    "rule": {
      "head": {
        "type": "Record",
        "relation": "cousin",
        "attrs": {
          "left": {
            "type": "Var",
            "name": "L"
          },
          "right": {
            "type": "Var",
            "name": "R"
          }
        }
      },
      "body": {
        "type": "Or",
        "opts": [
          {
            "type": "And",
            "clauses": [
              {
                "type": "Record",
                "relation": "parent",
                "attrs": {
                  "child": {
                    "type": "Var",
                    "name": "L"
                  },
                  "mother": {
                    "type": "Var",
                    "name": "P1"
                  }
                }
              },
              {
                "type": "Record",
                "relation": "sibling",
                "attrs": {
                  "left": {
                    "type": "Var",
                    "name": "P1"
                  },
                  "right": {
                    "type": "Var",
                    "name": "P2"
                  }
                }
              },
              {
                "type": "Record",
                "relation": "parent",
                "attrs": {
                  "child": {
                    "type": "Var",
                    "name": "R"
                  },
                  "parent": {
                    "type": "Var",
                    "name": "P2"
                  }
                }
              }
            ]
          }
        ]
      }
    }
  },
  {
    "type": "Rule",
    "rule": {
      "head": {
        "type": "Record",
        "relation": "grandfather",
        "attrs": {
          "grandchild": {
            "type": "Var",
            "name": "A"
          },
          "grandfather": {
            "type": "Var",
            "name": "C"
          }
        }
      },
      "body": {
        "type": "Or",
        "opts": [
          {
            "type": "And",
            "clauses": [
              {
                "type": "Record",
                "relation": "parent",
                "attrs": {
                  "child": {
                    "type": "Var",
                    "name": "A"
                  },
                  "parent": {
                    "type": "Var",
                    "name": "B"
                  }
                }
              },
              {
                "type": "Record",
                "relation": "father",
                "attrs": {
                  "child": {
                    "type": "Var",
                    "name": "B"
                  },
                  "father": {
                    "type": "Var",
                    "name": "C"
                  }
                }
              }
            ]
          }
        ]
      }
    }
  },
  {
    "type": "Rule",
    "rule": {
      "head": {
        "type": "Record",
        "relation": "grandmother",
        "attrs": {
          "grandchild": {
            "type": "Var",
            "name": "A"
          },
          "grandmother": {
            "type": "Var",
            "name": "C"
          }
        }
      },
      "body": {
        "type": "Or",
        "opts": [
          {
            "type": "And",
            "clauses": [
              {
                "type": "Record",
                "relation": "child",
                "attrs": {
                  "child": {
                    "type": "Var",
                    "name": "A"
                  },
                  "parent": {
                    "type": "Var",
                    "name": "B"
                  }
                }
              },
              {
                "type": "Record",
                "relation": "mother",
                "attrs": {
                  "child": {
                    "type": "Var",
                    "name": "B"
                  },
                  "mother": {
                    "type": "Var",
                    "name": "C"
                  }
                }
              }
            ]
          }
        ]
      }
    }
  },
  {
    "type": "Rule",
    "rule": {
      "head": {
        "type": "Record",
        "relation": "grandparent",
        "attrs": {
          "grandchild": {
            "type": "Var",
            "name": "A"
          },
          "grandparent": {
            "type": "Var",
            "name": "C"
          }
        }
      },
      "body": {
        "type": "Or",
        "opts": [
          {
            "type": "And",
            "clauses": [
              {
                "type": "Record",
                "relation": "parent",
                "attrs": {
                  "child": {
                    "type": "Var",
                    "name": "A"
                  },
                  "parent": {
                    "type": "Var",
                    "name": "B"
                  }
                }
              },
              {
                "type": "Record",
                "relation": "parent",
                "attrs": {
                  "child": {
                    "type": "Var",
                    "name": "B"
                  },
                  "parent": {
                    "type": "Var",
                    "name": "C"
                  }
                }
              }
            ]
          }
        ]
      }
    }
  },
  {
    "type": "Rule",
    "rule": {
      "head": {
        "type": "Record",
        "relation": "parent",
        "attrs": {
          "child": {
            "type": "Var",
            "name": "C"
          },
          "parent": {
            "type": "Var",
            "name": "P"
          }
        }
      },
      "body": {
        "type": "Or",
        "opts": [
          {
            "type": "And",
            "clauses": [
              {
                "type": "Record",
                "relation": "mother",
                "attrs": {
                  "child": {
                    "type": "Var",
                    "name": "C"
                  },
                  "mother": {
                    "type": "Var",
                    "name": "P"
                  }
                }
              }
            ]
          },
          {
            "type": "And",
            "clauses": [
              {
                "type": "Record",
                "relation": "father",
                "attrs": {
                  "child": {
                    "type": "Var",
                    "name": "C"
                  },
                  "father": {
                    "type": "Var",
                    "name": "P"
                  }
                }
              }
            ]
          }
        ]
      }
    }
  },
  {
    "type": "Rule",
    "rule": {
      "head": {
        "type": "Record",
        "relation": "sibling",
        "attrs": {
          "left": {
            "type": "Var",
            "name": "L"
          },
          "right": {
            "type": "Var",
            "name": "R"
          }
        }
      },
      "body": {
        "type": "Or",
        "opts": [
          {
            "type": "And",
            "clauses": [
              {
                "type": "Record",
                "relation": "mother",
                "attrs": {
                  "child": {
                    "type": "Var",
                    "name": "L"
                  },
                  "mother": {
                    "type": "Var",
                    "name": "M"
                  }
                }
              },
              {
                "type": "Record",
                "relation": "father",
                "attrs": {
                  "child": {
                    "type": "Var",
                    "name": "L"
                  },
                  "father": {
                    "type": "Var",
                    "name": "F"
                  }
                }
              },
              {
                "type": "Record",
                "relation": "mother",
                "attrs": {
                  "child": {
                    "type": "Var",
                    "name": "R"
                  },
                  "mother": {
                    "type": "Var",
                    "name": "M"
                  }
                }
              },
              {
                "type": "Record",
                "relation": "father",
                "attrs": {
                  "child": {
                    "type": "Var",
                    "name": "R"
                  },
                  "father": {
                    "type": "Var",
                    "name": "F"
                  }
                }
              }
            ]
          }
        ]
      }
    }
  }
]

statement
msg{
  from: "B1", to: "S",
  time: 1,
  payload: login{
    username: "vilterp@example.com", password: "password"
  }
}.
----
application/json
{
  "type": "Insert",
  "record": {
    "type": "Record",
    "relation": "msg",
    "attrs": {
      "from": {
        "type": "StringLit",
        "val": "B1"
      },
      "to": {
        "type": "StringLit",
        "val": "S"
      },
      "time": {
        "type": "IntLit",
        "val": 1
      },
      "payload": {
        "type": "Record",
        "relation": "login",
        "attrs": {
          "username": {
            "type": "StringLit",
            "val": "vilterp@example.com"
          },
          "password": {
            "type": "StringLit",
            "val": "password"
          }
        }
      }
    }
  }
}

rule
a{} :- !b{}.
----
application/json
{
  "type": "Rule",
  "rule": {
    "head": {
      "type": "Record",
      "relation": "a",
      "attrs": {}
    },
    "body": {
      "type": "Or",
      "opts": [
        {
          "type": "And",
          "clauses": [
            {
              "type": "Negation",
              "record": {
                "type": "Record",
                "relation": "b",
                "attrs": {}
              }
            }
          ]
        }
      ]
    }
  }
}
